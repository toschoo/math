%% =======================================================
%% (c) Tobias Schoofs
%% =======================================================
%% Math 4 Programmers - The Continuum
%% =======================================================

% Plain Style
\documentclass[tikz]{scrreprt}

% Springer Style
%\documentclass[envcountsame]{llncs}

%
%
\makeatletter
\@ifundefined{lhs2tex.lhs2tex.sty.read}%
  {\@namedef{lhs2tex.lhs2tex.sty.read}{}%
   \newcommand\SkipToFmtEnd{}%
   \newcommand\EndFmtInput{}%
   \long\def\SkipToFmtEnd#1\EndFmtInput{}%
  }\SkipToFmtEnd

\newcommand\ReadOnlyOnce[1]{\@ifundefined{#1}{\@namedef{#1}{}}\SkipToFmtEnd}
\usepackage{amstext}
\usepackage{amssymb}
\usepackage{stmaryrd}
\DeclareFontFamily{OT1}{cmtex}{}
\DeclareFontShape{OT1}{cmtex}{m}{n}
  {<5><6><7><8>cmtex8
   <9>cmtex9
   <10><10.95><12><14.4><17.28><20.74><24.88>cmtex10}{}
\DeclareFontShape{OT1}{cmtex}{m}{it}
  {<-> ssub * cmtt/m/it}{}
\newcommand{\texfamily}{\fontfamily{cmtex}\selectfont}
\DeclareFontShape{OT1}{cmtt}{bx}{n}
  {<5><6><7><8>cmtt8
   <9>cmbtt9
   <10><10.95><12><14.4><17.28><20.74><24.88>cmbtt10}{}
\DeclareFontShape{OT1}{cmtex}{bx}{n}
  {<-> ssub * cmtt/bx/n}{}
\newcommand{\tex}[1]{\text{\texfamily#1}}	% NEU

\newcommand{\Sp}{\hskip.33334em\relax}
\newcommand{\NB}{\textbf{NB}}
\newcommand{\Todo}[1]{$\langle$\textbf{To do:}~#1$\rangle$}

\EndFmtInput
\makeatother
%

\include{cmds}

\begin{document}
\setlength{\parindent}{0pt}
\setlength{\parskip}{8pt}

\chapter{Real Numbers} % c06
\section{$\sqrt{2}$}
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape Sqrt2}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}
\end{tabbing}
}

Until now, we have looked at \term{discrete} numbers,
that is numbers that are nicely separated from each other
so that we can write them down unmistakebly
and always know of which number we are currently talking.
Now we enter a completely different universe.
The universe of continuous numbers that cannot be
written down in a finite number of steps.
The representation of these numbers consists of
infinitely many elements and, therefore, we will never
be able to write the number down completely
with all its elements.
We may give a finite formula 
that describes how to compute the specific number,
but we will never see the whole number written down.
Those numbers are known since antiquity and,
apparently, their existence came as a great surprise
to Greek mathematicians.

The first step of our investigations into
this kind of numbers, is to show that they \term{exist},
\ie, there are contexts where they arise naturally.
To start, we will assume that they are not necessary.
We assume that all numbers are either natural,
integral or fractional.
Indeed, any of the fundamental arithmetic operations,
$+,-,\times$ and $/$, applied on two rational numbers
results always in a rational number,
\ie\ an integer or a fraction.
We could therefore suspect
that the result of any operation is a rational number,
\ie\ an integer or a fraction.

What about $\sqrt{2}$, the square root of 2?
Let us assume that $\sqrt{2}$ is as well a fraction.
Then we have two integers $n$ and $d$,
coprime to each other, such that

\begin{equation}
\sqrt{2} = \frac{n}{d}
\end{equation}

and

\begin{equation}
2 = \left(\frac{n}{d}\right)^2 = \frac{n^2}{d^2}.
\end{equation}

Any number can be represented as a product of primes.
If $p_1p_2\dots p_n$ is the prime factorsiation of $n$
and $q_1q_2\dots q_d$ is that of $d$,
we can write:

\begin{equation}
\sqrt{2} = \frac{p_1p_2\dots p_n}{q_1q_2\dots q_d}.
\end{equation}

It follows that 

\begin{equation}\label{eq:sqrt2_4}
2 = \frac{p_1^2p_2^2\dots p_n^2}{q_1^2q_2^2\dots q_d^2}.
\end{equation}

As we know from the previous chapter,
two different prime numbers $p$ and $q$ squared 
(or raised to any integer)
do not result in two numbers that share factors.
The factorisation of $p^n$ is just $p^n$ and that
of $q^n$ is just $q^n$. They are coprime to each other.
The fraction in equation \ref{eq:sqrt2_4}, thus,
cannot represent an integer, such as 2.
There is only one way for such a fraction to
result in an integer, \viz, 
when the numerator is an integer and the denominator is 1,
which is obviously not the case for $\sqrt{2}$.
It follows that, if the root of an integer is not an integer itself,
it is not a rational number either.

But, if $\sqrt{2}$ is not a rational number,
a number that can be represented as the fraction
of two integers, what the heck is it then?

There are several methods to approximate the number $\sqrt{n}$.
The simplest and oldest is the \term{Babylonian} method,
also called \term{Heron's} method for Heron of Alexandria,
a Greek mathematician of the first century who lived in 
Alexandria.

The idea of Heron's method, basically, is to
iteratively approximate the real value starting with a guess.
We can start with some arbitrary value.
If the first guess, say $g$, does not equal $\sqrt{n}$, 
\ie\ $gg \neq n$, then $g$
is either slightly too big or too small.
We either have $gg > n$ or $gg < n$.
So, on each step, we improve a bit on the value
by taking the average of $g$ and its counterpart $n/g$.
If $gg > n$, then clearly $n/g < g$ and, 
if $gg < n$, then $n/g > g$.
The average of $g$ and $a/g$ is calculated as
$(g+a/g)/2$. The result is used as input for the next round.
The more iterations of this kind we do,
the better is the approximation. In Haskell:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~heron~::~{\itshape Natural}~\char'31~{\itshape Natural}~\char'31~{\itshape Double}\\
\texfamily ~~heron~n~s~=~{\bfseries let}~a~~~=~fromIntegral~n~{\bfseries in}~go~s~a~(a/2)\\
\texfamily ~~~~{\bfseries where}~~go~0~\char95 ~x~~~=~x\\
\texfamily ~~~~~~~~~~~go~i~a~x~~~|~~xx~=~a~~~~~=~x\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~|~~otherwise~~=~go~(i-1)~a~((x~+~a/x)/2)
\end{tabbing}
\end{minipage}

The function takes two arguments.
The first is the number whose square root we want to calculate
and the second is the number of iterations we want to do.
We then call \text{\texfamily go} with $s$, the number of iterations,
$a$, the \text{\texfamily {\itshape Double}} representation of $n$, and our first guess
$a/2$.

In \text{\texfamily go}, if we have reached $i=0$, we yield the result $x$.
Otherwise, we call \text{\texfamily go} again with $i-1$, $a$ and 
the average of $x$ and $a/x$.

Let us compute $\sqrt{2}$ following this approach for, say,
five iterations. We first have

\begin{minipage}{\textwidth}
\text{\texfamily go\Sp 5\Sp 2\Sp 1\Sp \Sp \Sp \Sp \Sp \Sp \Sp \Sp =\Sp go\Sp 4\Sp 2\Sp ((1\Sp +\Sp 2)/2)}\\
\text{\texfamily go\Sp 4\Sp 2\Sp 1.5\Sp \Sp \Sp \Sp \Sp \Sp =\Sp go\Sp 3\Sp 2\Sp ((1.5\Sp +\Sp 2/1.5)\Sp /\Sp 2)}\\
\text{\texfamily go\Sp 3\Sp 2\Sp 1.416666\Sp =\Sp go\Sp 2\Sp 2\Sp ((1.416666\Sp +\Sp 2\Sp /\Sp 1.416666)/2)}\\
\text{\texfamily go\Sp 2\Sp 2\Sp 1.414215\Sp =\Sp go\Sp 1\Sp 2\Sp ((1.414215\Sp +\Sp 2\Sp /\Sp 1.414215)/2)}\\
\text{\texfamily go\Sp 1\Sp 2\Sp 1.414213\Sp =\Sp go\Sp 0\Sp 2\Sp ((1.414213\Sp +\Sp 2\Sp /\Sp 1.414213)/2)}\\
\text{\texfamily go\Sp 1\Sp 2\Sp 1.414213\Sp =\Sp 1.414213}.
\end{minipage}

Note that we do not show the complete \text{\texfamily {\itshape Double}} value,
but only the first six digits. The results of the last two
steps, therefore, are identical. They differ, in fact, at the
twelfth digit: 
$1.4142135623746899$ (\text{\texfamily heron\Sp 2\Sp 4}) versus
$1.414213562373095$  (\text{\texfamily heron\Sp 2\Sp 5}). 
Note that the result of five iterations has one digit less
than that of four iterations.
This is because that after the last digit, 5,
the digit 0 follows and then the \term{precision} of 
the Double number type is exhausted.
\term{Irrational} numbers, this is the designation of
the type of numbers we are talking about, 
consist of infinitely many digits. 
Therefore, the last digit in the number presented above
is in fact not the last digit of the number. 
With slightly higher precision, we would see that the number
continues like $03\dots$

The result of \text{\texfamily (heron\Sp 2\Sp 5)\char94 2} is fairly close to 2: 
$1.9999999999999996$.
It will not get any closer using \text{\texfamily {\itshape Double}} representation.
\section{$\Phi$}
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape Phi}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}
\end{tabbing}
}

Another interesting irrational number
is $\tau$ or $\Phi$,
known as the \term{divine proportion} or \term{golden ratio}.
The golden ratio is the relation of two quantities,
such that the greater relates to the lesser
as the sum of both to the greater.
This may sound confusing, so here are two symbolic
representations:

\begin{equation}
\frac{a}{b} = \frac{a+b}{a}.
\end{equation}

In this equation, $a$ is the greater number
and $b$ the lesser. The equation states
that the relation of $a$ to $b$ equals the relation
of $a+b$ to $a$.
Alternatively we can say

\begin{equation}\label{eq:phi_2}
\frac{b}{a} = \frac{a}{b-a}.
\end{equation}

Here $b$ is the sum of the two quantities
and $a$ is the greater one.
The equation states that the relation
of $b$ to $a$ is the same as the relation
of $a$ to $b-a$, which, of course, is
then the smaller quantity.

The golden ratio is known since antiquity.
The symbol $\Phi$ is an homage to ancient Greek
sculptor and painter Phidias (480 -- 430 \acronym{bc}).
Its first heyday after antiquity was
during Renaissance and then it was again
extremely popular in the $18^{th}$ and $19^{th}$ centuries.
Up to our times, artists, writers and mathematicians 
have repeatedly called the golden ratio 
especially pleasing. 

From equation \ref{eq:phi_2} we can derive
the numerical value of $\Phi$ in the form
$\frac{\Phi}{1}$.
We can then calculate $b$,
for any value $a$,
as $a\Phi$.
The derivation uses some algebraic methods,
which we will study more closely in the next part,
especially \term{completing the square}.
As such this section is also an algebra teaser.

We start by setting $\Phi = \frac{b}{a}$
with $a = 1$.
We then have on the left side of the equation
$\Phi = \frac{b}{1} = b$.
On the right-hand side, we have
$\frac{a=1}{\Phi - 1}$:

\begin{equation}
\Phi = \frac{1}{\Phi - 1}.
\end{equation}

Multiplying both sides by $\Phi - 1$,
we get 

\begin{equation}
\Phi^2 - \Phi = 1.
\end{equation}

This is a quadratic equation and,
with some phantasy, we even
recognise the fragment of a binomial formula on the
left side. A complete binomial formula would be

\begin{equation}
(a-b)^2 = a^2-2ab+b^2.
\end{equation}

We try to pattern match the fragment above
such that $\Phi^2$ is $a^2$ and $-\Phi$
is $-2ab$. That would mean that the last term,
$b^2$ would correspond to the square half of the number
that is multiplied by $\Phi$ to yield $-\Phi$.
$-\Phi$ can be seen as $-1 \times \Phi$.
Half of that number is $-\frac{1}{2}$.
That squared is $\frac{1}{4}$.
So, if we add $\frac{1}{4}$ to both sides of the equation,
we would end up with a complete binomial formula on 
the left side:

\begin{equation}
\Phi^2 - \Phi + \frac{1}{4} = 1 + \frac{1}{4} = \frac{5}{4}.
\end{equation}

We can apply the binomial theorem on the left side and get

\begin{equation}
\left(\Phi - \frac{1}{2}\right)^2 = \frac{5}{4}.
\end{equation}

Now we take the square root:

\begin{equation}
\Phi - \frac{1}{2} = \frac{\pm\sqrt{5}}{2}.
\end{equation}

Note that the $\pm$ in front of $\sqrt{5}$
reflects the fact that the square root
of 5 (or any other number) may be positive
or negative. Both solutions are possible.
However, since we are looking for a positive
relation, we only consider the positive solution
and ignore the other one. We can therefore simplify to

\begin{equation}
\Phi - \frac{1}{2} = \frac{\sqrt{5}}{2}.
\end{equation}

Finally, we add $\frac{1}{2}$ to both sides:

\begin{equation}
\Phi = \frac{1+\sqrt{5}}{2}
\end{equation}

and voilá that is $\Phi$.
The numerical value is approximately
\num{1.618033988749895}.
We can define it as a constant in Haskell as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~phi~::~{\itshape Double}\\
\texfamily ~~phi~=~0.5~*~(1~+~sqrt~5)
\end{tabbing}
\end{minipage}

We can now define a function that, for any given $a$,
yields $b$:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~golden~::~{\itshape Double}~\char'31~{\itshape Double}\\
\texfamily ~~golden~a~=~a~*~phi
\end{tabbing}
\end{minipage}

\text{\texfamily golden\Sp 1}, of course, is just $\Phi$, \ie\ 
\num{1.618033988749895}.
\text{\texfamily golden\Sp 2} is twice that value, namely \num{3.23606797749979}.
Furthermore, we can state that
\text{\texfamily 2\Sp /\Sp (golden\Sp 2\Sp -\Sp 2)}, which is $\frac{a}{b-a}$, is
again an approximation
of $\Phi$.

That is very nice. But there is more to come.
$\Phi$, in fact, is intimately connected to the Fibonacci sequence,
as we will se in the next chapter.









\section{$\pi$}
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape Pi}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}
\end{tabbing}
}

$\pi$ is probably the most famous 
irrational number. 
It emerged in antique mathematics
in studying the circle where
it expresses the relation between
the diameter (depicted in red in the
image below) and the circumference
(depicted in black):

\begin{center}
\begin{tikzpicture}
\draw (1,1) circle (1cm);
\draw [color=red] (0.3,0.3) -- (1.7,1.7);
% \draw [color=blue] (0.3,1.7) -- (1,1);
\end{tikzpicture}
\end{center}

Since, often, the radius,
which is half the diameter, is much more
important in mathematics, it has been
proposed to use $\tau = 2\pi$ where 
$\pi$ is used today.
But $\pi$ has survived through history
and, even though slightly suboptimal
in some situations, it is still in use today.

The reason why the perimeter 
instead of the radius was used
to define the circle constant is probably
because classic approaches to approximate $\pi$
take the perimeter as basis.
They start by drawing a square with side length 1
and inscribe a circle into the square with 
perimeter 1:

\begin{center}
\begin{tikzpicture}
\draw [blue] (0,0) rectangle (2,2);
\draw (1,1) circle (1cm);
\end{tikzpicture}
\end{center}

Since the square has side length 1,
its perimeter, the sum of all its sides is
$1+1+1+1 = 4$ and, as we can see clearly
in the picture above, this perimeter
is greater than that of the circle.
4, hence, is an upper bound for the circumference
of the circle with perimeter 1.
A lower bound would then be given
by a square inscribed in the circle,
such that the distance between 
its opposing corners (red) is 1, the perimeter
of the circle:

\begin{center}
\begin{tikzpicture}
\draw [blue] (0,0) rectangle (2,2);
\draw (1,1) circle (1cm);
\draw [green] (0.3,0.3) rectangle (1.7,1.7);
\draw [color=red] (0.3,0.3) -- (1.7,1.7);
\end{tikzpicture}
\end{center}

We see two right triangles with two green sides 
on a red basis. The basis is the perimeter
of the circle, of which we know that its length is 1.
You certainly know the Pythagorean theorem,
probably the most famous or notorious theorem of all mathematics,
which states that, in a right triangle,
one with a right angle, an angle of 90°, the sum of the squares
of the sides to the left and right of that angle (the green sides)
equals the square of the hypothenuse, the red side,
which is opposite to the right angle.
This can be stated as:

\begin{equation}
a^2 = b^2 + c^2,
\end{equation}

where $a$ is the red side, whose length we know,
namely 1. We further know that the green sides
are equal. We hence have:

\begin{equation}
1^2 = 2b^2.
\end{equation}

and further derive

\begin{equation}
1 = \sqrt{2b^2},
\end{equation}

which is

\begin{equation}
1 = \sqrt{2}b.
\end{equation}

Dividing both sides by $\sqrt{2}$, 
we get 

\begin{equation}
b = \frac{1}{\sqrt{2}},
\end{equation}

the side length of the green square, which is
approximately 0.707. The perimeter of
the inner square is thus $4 \times 0.707$,
which is approximately 2.828.
Thus $\pi$ is some value between 2.828 and 4.

That result is not very satifactory, of course.
There is room for a lot of numbers between
2.828 and 4. The method was therefore extended
by choosing polygons with more than four sides
to come closer to the real value of $\pi$.
The ancient record holder for approximating $\pi$
is Archimedes who started off with a hexagon,
which is easy to construct with compass and ruler:

\begin{center}
\begin{tikzpicture}
\draw [blue] (-0.15,1) -- (0.4,2) -- (1.6,2) -- ( 2.15,1)
                       -- (1.6,0) -- (0.4,0) -- (-0.15,1);
\draw [red] (1,1) circle (1cm);
\draw [green] (0,1) -- (0.45,1.82) -- (1.55,1.82) -- (2,1) 
                    -- (1.55,0.18) -- (0.45,0.18) -- (0,1);
\end{tikzpicture}
\end{center}

Then he subsequently doubled the number of sides
of the polygon, so that he obtained polygons with
12, 24, 48 and, finally, 96 sides. With this approach
he concluded that $\frac{223}{71} < \pi < \frac{22}{7}$,
which translates to a number between 3.1408 and 3.1428
and is pretty close to the approximated value 3.14159.

In modern times, mathematicians started to search
for approximations by other means than geometry,
in particular by infinite series. One of the first series
was discovered by Indian mathematician Nilakantha Somayaji
(1444 -- 1544). It goes like

\begin{equation}
  \pi = 3 + \frac{4}{2\times 3 \times 4} -
            \frac{4}{4\times 5 \times 6} +
            \frac{4}{6\times 7 \times 8} -
            \dots
\end{equation}

We can implement this in Haskell as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~nilak~::~{\itshape Int}~\char'31~{\itshape Double}\\
\texfamily ~~nilak~i~~|~even~i~~~~~=~~nilak~(i+1)\\
\texfamily ~~~~~~~~~~~|~otherwise~~=~~go~i~~2~3~4\\
\texfamily ~~~~{\bfseries where}~~go~0~\char95 ~\char95 ~\char95 ~~=~~3\\
\texfamily ~~~~~~~~~~~go~n~a~b~c~~=~~{\bfseries let}~k~~|~even~n~~~~=~-4\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|~otherwise~=~~4\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~{\bfseries in}~(k/(a*b*c))~+~go~(n-1)~c~(c+1)~(c+2)
\end{tabbing}
\end{minipage}

Here we use a negative term, whenever $n$,
the counter for the step we are performing,
is even. Since, with this approach, an even number
of steps would produce a bad approximation, 
we perform, for $i$ even, $i+1$
and hence an odd number
of steps.
This way, the series converges to 3.14159
after about 35 steps, \ie\ \text{\texfamily nilak\Sp 35} is
some number that starts with 3.14159.

An even faster convergence is obtained by
the beautiful series discovered by French mathematician
François Viète (1540 -- 1603) in 1593:

\begin{equation}
\frac{2}{\pi} = \frac{\sqrt{2}}{2} \times
                \frac{\sqrt{2+\sqrt{2}}}{2} \times
                \frac{\sqrt{2+\sqrt{2+\sqrt{2}}}}{2} \times
                \dots
\end{equation}

In Haskell this gives rise to a 
very nice recursive function:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~vietep~::~{\itshape Int}~\char'31~{\itshape Double}\\
\texfamily ~~vietep~i~=~2~/~(go~0~(sqrt~2))\\
\texfamily ~~~~{\bfseries where}~go~n~t~~|~n~\char'36~i~~~~~=~1\\
\texfamily ~~~~~~~~~~~~~~~~~~|~otherwise~~=~(t/2)~*~go~(n+1)~(sqrt~(2+t))
\end{tabbing}
\end{minipage}

The approximation 3.14159 is reached with \text{\texfamily vietep\Sp 10}.

There are many other series, 
some focusing on early convergence,
others on beauty.
An exceptionally beautiful series is
that of German polymath Gottfried Wilhelm Leibniz
(1646 -- 1716), who we will get to know more closely
later on:

\begin{equation}
\frac{\pi}{4} = \frac{1}{1} -
                \frac{1}{3} + 
                \frac{1}{5} - 
                \frac{1}{7} + 
                \frac{1}{9} -
                \dots
\end{equation}

In Haskell this is, for instance:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~leipi~::~{\itshape Int}~\char'31~{\itshape Double}\\
\texfamily ~~leipi~i~=~4~*~go~0~1\\
\texfamily ~~~~{\bfseries where}~go~n~d~~|~n~\char'36~i~~~~~=~0\\
\texfamily ~~~~~~~~~~~~~~~~~~|~otherwise~~=~~{\bfseries let}~x~~|~even~n~~~~=~1\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|~otherwise~=~-1~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~{\bfseries in}~x/d~+~go~(n+1)~(d+2)
\end{tabbing}
\end{minipage}

This series converges really slowly.
We reach 3.14159 only after about \num{400000} steps.

$\pi$ appears quite often in mathematics,
particularly in geometry. But there are also some
unexpected entries of this number.
The inevitable Leonhard Euler solved a function,
which today is called \term{Riemann zeta function},
for the special case $s=2$:

\begin{equation}
  \zeta(s) = \frac{1}{1^s} + 
             \frac{1}{2^s} + 
             \frac{1}{3^s} + 
             \dots = \sum_{n=1}^{\infty}{\frac{1}{n^s}}.
\end{equation}

Euler showed that, for the special case $s=2$,
$\zeta(s)$ converges to $\frac{\pi^2}{6}$; in fact, for any $n$,
$n$ a multiple of 2, $\zeta(n)$
converges to some fraction of a power of $\pi$,
\eg\ $\zeta(4)$ approaches $\frac{\pi^4}{90}$,
$\zeta(6)$ approaches $\frac{\pi^6}{945}$ and so on.

This is surprising, because the zeta function
is not related to circles, but to number theory.
It appears for example, when calculating the
probability of two numbers being coprime to each other.
Two numbers are coprime if they do not share
prime factors. The probability of a number
being divisible by a given prime $p$ is $\frac{1}{p}$,
since every $p^{th}$ number is divisible by $p$.
For two independently chosen numbers, the
probability that both are divisible by prime $p$
is therefore $\frac{1}{p} \times \frac{1}{p} = \frac{1}{p^2}$.
The reverse probability that both are not divisible
by that prime, hence, is $1-\frac{1}{p^2}$.
The probablitiy that there is no prime at all
that divides both is then

\begin{equation}
  \prod_p^{\infty}{1-\frac{1}{p^2}}.
\end{equation}

To cut a long story short,
this equation can be transformed into
the equation

\begin{equation}
  \frac{1}{1+\frac{1}{2^2} + \frac{1}{3^2} + \dots} = 
  \frac{1}{\zeta(2)} = \frac{1}{\frac{\pi^2}{6}} =
  \frac{6}{\pi^2} = 0.607 \approx 61\%
\end{equation}

and with this $\pi$ appears as a constant in
number theory expressing the probability
of two randomly chosen numbers being coprime to each other.
\section{$e$}
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape E}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~{\itshape Fact}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}\\
\texfamily ~~{\bfseries import}~{\itshape Zahl}
\end{tabbing}
}

The Bernoullis were a family of Huguenots from Antwerp
in the Spanish Netherlands from where they fled the repression
by the Catholic Spanish authorities, first to Frankfurt am Main,
later to Basel in Switzerland. Among the Bernoullis,
there is a remarkable number of famous mathematicians
who worked in calculus,
probability theory, number theory and many areas 
of applied mathematics. One of the Basel Bernoullis was
Johann Bernoulli (1667 -- 1748) who worked mainly
in calculus and tutored famous mathematicians like 
Guillaume L'Hôpital, but whose greatest contribution
to the history of math was perhaps to recognise 
the enormous talent of another of his pupils 
whose name was Leonhard Euler. 

His brother Jacob Bernoulli (1655 -- 1705),
who worked, as his brother, in calculus, but
most prominently in probability theory, 
is much better known today, partly perhaps
because many of Johann's achievements 
were published under the name of L'Hôpital.
Unfortunately, early modern mathematics 
and science in general was
plagued with disputes over priorities in the
authorship of contributions, a calamity
that authors and authorities later tried to
solve by introducing the \term{droite d'auteur},
better known in the English speaking world as
\term{copyright}.

Among the many problems Jacob studied was
the calculation of interests. He started off
with a very simple problem. Suppose we have
a certain amount of money and a certain interest
credited after a given amount of time. To keep it
simple, let the amount equal 1 (of any currency
of your liking -- currencies in Jacob's lifetime
were extremely complicated, so we better ignore
that detail). After one year $100\%$ interest is paid.
After that year, we hence have $1+\frac{1\times 100}{100} = 2$ 
in our account. That is trivial.
But what, if the interest is paid in shorter periods
during the year?
For instance, if the interest is paid twice a year,
then the interest for that period would be $50\%$.
After six months we would have $1+\frac{1\times 50}{100} = 1.5$
in our account. After one year, the account would then be
$1.5 + \frac{1.5\times 50}{100} = 1.5 + \frac{75}{100} = 1.5 + 0.75 = 2.25$.

Another way to see this is that the initial value 
is multiplied by 1.5 (the initial value plus the interest) twice:
$1 \times 1.5 \times 1.5 = 1 \times 1.5^2 = 2.25$.
When we reduce the period even further, say, to three months,
then we had $1.25^4 \approx 2.4414$. On a monthly base,
we would get $\left(1+\frac{1}{12}\right)^{12} \approx 2.613$.
On a daily basis, we would have 
$\left(1+\frac{1}{365}\right)^{365} \approx 2.7145$.
With hourly interests and the assumption
that one year has $24 \times 365 = 8760$ hours, 
we would get $\left(1+\frac{1}{8760}\right)^{8760} \approx 2.71812$.
With interest paid per minute we would get
$\left(1+\frac{1}{525600}\right)^{525600} \approx 2.71827$ and
on interest paid per second, we would get
$\left(1+\frac{1}{3156000}\right)^{3156000} \approx 2.71828$.
In general, for interest on period $n$, we get:

\[
\left(1+\frac{1}{n}\right)^n.
\] 

You may have noticed in the examples above
that this formula converges with greater and greater $n$s.
For $n$ approaching $\infty$, it converges
to $2.71828$, a number that is so beautiful that we should
look at more than just the first 5 digits:

\begin{center}
2.7 1828 1828 4590 4523$\dots$
\end{center}

This is $e$.
It is called Euler's number or, 
for the first written appearance 
of concepts related to it in 1618,
Napier's number.
It is a pity that its first mentioning
was not in the year 1828.
But who knows -- perhaps in some rare
Maya calendar the year 1618 
actually is the year 1828.

An alternative way to approach $e$
that converges much faster than the closed form above
is the following:

\[
1+\frac{1}{2}+\frac{1}{6}+\frac{1}{24}+\frac{1}{120}+\dots
\]

or, in other words:

\begin{equation}
e = \sum_{n=1}^{\infty}{\frac{1}{n!}}.
\end{equation}

We can implement this equation in Haskell as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~e\char95 ~::~{\itshape Integer}~\char'31~{\itshape Double}\\
\texfamily ~~e\char95 ~p~=~1~+~sum~[1/(dfac~n)~|~n~\char'06~[1..p]]\\
\texfamily ~~~~{\bfseries where}~dfac~=~fromInteger~\char'00~fac
\end{tabbing}
\end{minipage}

After some experiments with this function,
we see that
it converges already after 17 recursions
to a value that does not change with greater
arguments at \text{\texfamily {\itshape Double}} precision, such that 
\text{\texfamily e\char95 \Sp 17\Sp \char'36\Sp e\char95 \Sp 18\Sp \char'36\Sp e\char95 \Sp 19\Sp \char'36} $\dots$
We could then implement \text{\texfamily e} as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~e~::~{\itshape Double}\\
\texfamily ~~e~=~e\char95 ~17
\end{tabbing}
\end{minipage}

The fact that $e$ is related to the factorial
may lead to the suspicion that it also appears
directly in a formula dealing with factorials. 
There, indeed, is a formula derived by James Stirling
who we already know for the Stirling numbers.
This formula approximates the value
of $n!$ without the need to go through all
the steps of its recursive definition.
Stirling's formula is as follows:

\begin{equation}
n! \approx \sqrt{2\pi n}\left(\frac{n}{e}\right)^n.
\end{equation}

This equation is nice already because of the fact
that $e$ and $\pi$ appear together to compute
the result of an important function.
But how precise is the approximation?
To answer this question, we first implement
Stirling's formula:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~stirfac~::~{\itshape Integer}~\char'31~{\itshape Integer}\\
\texfamily ~~stirfac~i~=~ceiling~\$~(sqrt~(2*\char'07*n))~*~(n/e)\char94 i\\
\texfamily ~~~~{\bfseries where}~n~=~fromIntegral~i
\end{tabbing}
\end{minipage}

Note that we \emph{ceil} the value, instead of
rounding it just to the next integer value.

Then we define a function to compute the difference
\text{\texfamily difac\Sp n\Sp =\Sp fac\Sp n\Sp -\Sp stirfac\Sp n}.
The result for the first 15 numbers is

\[
0,0,0,0,1,9,59,417,3343,30104,301174,3314113,39781324,517289459,7243645800.
\]

For the first numbers, the difference is 0. Indeed:

\begin{align*}
1! && = && stirfac(1) && = && 1\\
2! && = && stirfac(2) && = && 2\\
3! && = && stirfac(3) && = && 6\\
4! && = && stirfac(4) && = && 24
\end{align*}

Then, the functions start to disagree,
for instance $5! = 120 \neq stirfac(5) = 119$.
The difference grows rapidly and reaches more
than 3 million with $12!$. But what is the deviation
in relation to the real value?
We define the function 
\text{\texfamily 100\Sp *\Sp (fromIntegral\Sp \$\Sp difac\Sp n)\Sp /\Sp (fromIntegral\Sp \$\Sp fac\Sp n)}
to obtain the difference in terms of a percentage
of the real value. We see starting from 5
(where the first difference occurs):

\[
0.8333,
1.25,
1.1706,
1.0342,
0.9212,
0.8295,
0.7545,
0.6918,
0.6388,
0.5933,
0.5539,\dots
\]

For 5, the value jumps up from 0 to $0.8333\%$,
climbs even higher to $1.25\%$ and then starts
to descrease slowly.
At 42 the deviation falls below $0.2\%$.
At 84, it falls below $0.1\%$ and keeps falling.
Even though the difference appears big
in terms of absolute numbers, the percentage
quickly shrinks and, for some problems, may
even be neglible.

A completely different way to approximate $e$
is by \term{continued fractions}.
Continued fractions are infinite fractions,
where each denominator is again a fraction.
For instance:

\begin{equation}
  e =  1 + \frac{1}{
         1 + \frac{1}{
           2 + \frac{1}{
             1 + \frac{1}{
               1 + \frac{1}{
                 4 + \frac{1}{\dots}}}}}}
\end{equation}

A more readable representation of continued fractions
is by sequences of the denominator like:

\begin{equation}
e = [2;1,2,1,1,4,1,1,6,1,1,8,1,1,\dots]
\end{equation}

where the first number is separated by a semicolon
to highlight the fact that it is not a denominator,
but an integral number added to the fraction that follows.
We can capture this very nicely in Haskell,
using just a list of integers.
However, in some cases we might have a fraction
with numerators other than 1.
An elegant way to represent this case is by
using fractions instead of integers.
We would then represent $\frac{2}{a + \dots}$
as $\frac{1}{\frac{1}{2}a + \dots}$.
Here is an implementation:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~contfrac~::~[{\itshape Quoz}]~\char'31~{\itshape Double}\\
\texfamily ~~contfrac~[]~~=~1\\
\texfamily ~~contfrac~[i]~=~fromQuoz~i~\\
\texfamily ~~contfrac~(i:is)~=~n~+~1~/~(contfrac~is)\\
\texfamily ~~~~{\bfseries where}~n~=~fromQuoz~i\\
\texfamily \\
\texfamily ~~fromQuoz~::~{\itshape Quoz}~\char'31~{\itshape Double}\\
\texfamily ~~fromQuoz~i~=~{\bfseries case}~i~{\bfseries of}\\
\texfamily ~~~~~~~~~~~~~~~~({\itshape Pos}~({\itshape Q}~nu~d))~\char'31~fromIntegral~nu~/~fromIntegral~d\\
\texfamily ~~~~~~~~~~~~~~~~({\itshape Neg}~({\itshape Q}~nu~d))~\char'31~negate~(fromIntegral~nu~/~fromIntegral~d)
\end{tabbing}
\end{minipage}

For \text{\texfamily contfrac\Sp [2,1,2,1,1,4,1,1,6]} we get 2.7183,
which is not bad, but not yet too close to $e$. 
With \text{\texfamily [2,1,2,1,1,4,1,1,6,1,1,8,1,1,10]} we get \num{2.718281828},
which is pretty close.

Examining the sequence a bit further, we see
that is has a regular structure.
We can generate it by means of the \term{Engel expansion}
named for Friedrich Engel (1861 -- 1941), 
a German mathematician who worked close with the great
Norwegian algebraist Sophus Lie (1842 -- 1899).
The Engel expansion can be implemented as follows:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~engelexp~::~[{\itshape Integer}]\\
\texfamily ~~engelexp~=~2:1:go~1\\
\texfamily ~~~~{\bfseries where}~go~n~=~(2*n):1:1:go(n+1)
\end{tabbing}
\end{minipage}

The following fraction, however, conoverges
must faster than the Engel expansion:
$[1,\frac{1}{2},12,5,28,9,44,13]$.
Note that we take advantage of the datatype \text{\texfamily {\itshape Quoz}}
to represent a numerator that is not 1.
This sequence can be generated by means of 

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~fastexp~::~[{\itshape Quoz}]\\
\texfamily ~~fastexp~=~1:({\itshape Pos}~(1\%2)):go~1\\
\texfamily ~~~~{\bfseries where}~go~n~=~(16*n-4):(4*n+1):go~(n+1)
\end{tabbing}
\end{minipage}

This fraction converges already after 7 steps
to the value \num{2.718281828}: 

\text{\texfamily contfrac\Sp (take\Sp 7\Sp fastexp)}. 

The area of mathematics where $e$ is really at home
is analysis and its vast areas of application, 
which we will study in the third part of this series.
The reason for the prominence of $e$ in analysis
stems from the \term{natural logarithm},
which we already introduced in the first chapter.
The natural logarithm of a number $n$, 
usually denoted $\ln(n)$,
is the exponent $x$, such that $e^x = n$.

The natural logarithm can be graphed as follows:

\begin{center}
\begin{tikzpicture}[trim axis left]
\begin{axis}[
  step=1,
  domain=0:10,
  samples=100,
  % enlarge x limits=true,
  ymin=-2,ymax=5,
  xmin=0.01,xmax=10,xstep=1,
  grid=both,
  %axis equal,
  no markers]
\addplot +[thick] {ln(x)};
\addplot [black] {0};
\end{axis}
\end{tikzpicture}
\end{center}

The curious fact that earned the natural logarithm its name
is that, at $x=1$, the curve has the slope 1.
This might sound strange for the moment.
We will investigate that later.


\section{$\gamma$}
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape Gamma}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}
\end{tabbing}
}

The \term{harmonic series} is defined as

\begin{equation}
\sum_{n=1}^{\infty}{\frac{1}{n}} = 1 + 
  \frac{1}{2} + 
  \frac{1}{3} + 
  \frac{1}{4} + \dots
\end{equation}

A harmonoic series with respect to a given number $k$,
called the \term{harmonic number} $H_k$, then is

\begin{equation}
\sum_{n=1}^k{\frac{1}{n}} = 1 + 
  \frac{1}{2} + \dots +
  \frac{1}{k} 
\end{equation}

This is easily implemented in Haskell as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~harmonic~::~{\itshape Natural}~\char'31~{\itshape Double}\\
\texfamily ~~harmonic~n~=~sum~[1/d~|~d~\char'06~map~fromIntegral~[1..n]]
\end{tabbing}
\end{minipage}

Some harmonic numbers are (\text{\texfamily map\Sp harmonic\Sp [1..10]}):

$1, 1.5, 1.8\overline{3}, 2.08\overline{3}, 2.28\overline{3}, 
 2.44\overline{9}, 2.5928,2.7178, 2.8289, 2.9289.$

The harmonic series is an interesting object of study
in its own right. Here, however, we are interested in 
something else. Namely, the difference of the harmonic series
and the natural logarithm:

\begin{equation}
\gamma = \lim_{n \to \infty} H_n - \ln(n).
\end{equation}

We can implement this equation as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~harmonatural~::~{\itshape Natural}~\char'31~{\itshape Double}\\
\texfamily ~~harmonatural~n~=~harmonic~n~-~ln~n\\
\texfamily ~~~~{\bfseries where}~ln~=~log~\char'00~fromIntegral
\end{tabbing}
\end{minipage}

Applied on the first numbers with
\text{\texfamily map\Sp harmonatural\Sp [1..10]}, the function
does not show interesting results:

$1.0, 0.8068,0.7347,0.697,0.6738,0.6582,0.6469,0.6384,0.6317,0.6263,\dots$

Applied to greater numbers, however, the results approach a constant value:

\text{\texfamily harmonatural\Sp \Sp \Sp \Sp 100\Sp =\Sp 0.58220}\\
\text{\texfamily harmonatural\Sp \Sp \Sp 1000\Sp =\Sp 0.57771}\\
\text{\texfamily harmonatural\Sp \Sp 10000\Sp =\Sp 0.57726}\\
\text{\texfamily harmonatural\Sp 100000\Sp =\Sp 0.57722}

With even greater numbers, the difference converges to \num{0.57721}.
This number, $\gamma$, was first mentioned by -- surprise -- 
Leonhard Euler and some years later 
by Italian mathematician Lorenzo Mascheroni (1750 -- 1800) and
is therefore called the Euler-Mascheroni constant.

This mysterious number appears in different contexts and, apparently,
quite often as a difference or average.
An ingenious investigation was carried out by Belgian mathematician
Charles Jean de la Vallée-Poussin (1866 -- 1962) who is famous
for his proof of the Prime number theorem.
Vallée-Poussin studied the quotients of a number $n$ 
and the primes up to that number. If $n$ is not prime itself,
then there are some prime numbers $p$, 
namely those of the prime factorisation of $n$,
such that $\frac{n}{p}$ is an integer. 
For others, this quotient is a rational number,
which falls short of the next natural number.
For instance, there are four prime numbers less than 10:
2, 3, 5 and 7. The quotients are

$5, 3.\overline{3}, 2, 1.\overline{428571}$.

5 and 2, the quotients of 2 and 5, respectively,
are integers and there, hence, is no difference.
The quotient $\frac{10}{3} = 3.\overline{3}$, however,
falls short of 4 by $0.\overline{6}$ and
$\frac{10}{7} = 1.\overline{428571}$ falls short of 2 by
$0.\overline{57142828}$.

Vallée-Poussin asked what the average of this difference is.
For the example 10, the average is about
$0.3\overline{095238}$. 
One might think that this average, computed for many numbers
or for very big numbers, is about $0.5$, so that the probability
for the quotient of $n$ and a random prime number 
to fall into the first or the second half of the rational numbers
between two integers is equal, \ie\ $50\%$ for both cases.
It turns out it is not.
For huge numbers, de la Vallée-Poussin's average converges
to \num{0.57721}, the Euler-Mascheroni constant.

It converges quite slow, however.
If we implement the prime quotient as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~pquoz~::~{\itshape Natural}~\char'31~[{\itshape Double}]\\
\texfamily ~~pquoz~n~=~[d/p~|~p~\char'06~ps]\\
\texfamily ~~~~{\bfseries where}~~ps~~=~map~fromIntegral~(takeWhile~(<n)~allprimes)\\
\texfamily ~~~~~~~~~~~d~~~=~fromIntegral~n
\end{tabbing}
\end{minipage}

and its average as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~pquozavg~::~{\itshape Integer}~\char'31~{\itshape Double}\\
\texfamily ~~pquozavg~n~=~(sum~ds)~/~(fromIntegral~\$~length~ds)\\
\texfamily ~~~~{\bfseries where}~~qs~~=~pquoz~n\\
\texfamily ~~~~~~~~~~~ns~~=~map~(fromIntegral~\char'00~ceiling)~qs\\
\texfamily ~~~~~~~~~~~ds~~=~[n~-~q~|~(n,q)~\char'06~zip~ns~qs]
\end{tabbing}
\end{minipage}

we can experiment with some numbers like

\text{\texfamily pquozavg\Sp 10\Sp =\Sp }$0.3\overline{095238}$\\
\text{\texfamily pquozavg\Sp 100\Sp =\Sp 0.548731}\\
\text{\texfamily pquozavg\Sp 1000\Sp =\Sp 0.5590468}\\
\text{\texfamily pquozavg\Sp 10000\Sp =\Sp 0.5666399}\\
\text{\texfamily pquozavg\Sp 100000\Sp =\Sp 0.5695143}\\
$\dots$

With greater and greater numbers, this value
approaches $\gamma$. Restricting $n$ to prime numbers
produces good approximations of $\gamma$ much earlier. 
From 7 on, \text{\texfamily pquozavg} with primes results in numbers of the form
$0.5\dots$ \text{\texfamily pquozavg\Sp 43\Sp =\Sp 0.57416} 
is already very close to $\gamma$.
It may be mentioned that 43 is suspiciously close to 42.

With de la Vallée-Poussin's result in mind,
it is not too surprising that $\gamma$ is related
to divisors and Euler's totient number.
A result of Gauss' immediate successor in Göttingen, 
Peter Gustav Lejeune-Dirichlet (1805 -- 1859),
is related to the average number of divisors
of the numbers $1\dots n$.
We have already defined a function to generate
the divisors of a number $n$, namely \text{\texfamily divs}.
Now we map this function on all numbers up to $n$:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~divsupn~::~{\itshape Natural}~\char'31~[[{\itshape Natural}]]\\
\texfamily ~~divsupn~n~=~map~divs~[1..n]
\end{tabbing}
\end{minipage}

Applied to 10, this function yields:

\text{\texfamily [[1],[1,2],[1,3],[1,2,4],[1,5],[1,2,3,6],[1,7],[1,2,4,8],[1,3,9],[1,2,5,10]]}

For modelling Lejeune-Dirichlet's result,
we further need to count the numbers of divisors
of each number:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~ndivs~::~{\itshape Integer}~\char'31~[{\itshape Int}]\\
\texfamily ~~ndivs~=~map~length~\char'00~divsupn
\end{tabbing}
\end{minipage}

Applied again to 10, \text{\texfamily ndivs} produces:

\text{\texfamily [1,2,2,3,2,4,2,4,3,4]}

Now we compute the average of this list using

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~dirichlet~::~{\itshape Integer}~\char'31~{\itshape Double}\\
\texfamily ~~dirichlet~n~~~=~s~/~l\\
\texfamily ~~~~{\bfseries where}~~~ds~~=~ndivs~n\\
\texfamily ~~~~~~~~~~~~l~~~=~fromIntegral~\$~length~ds\\
\texfamily ~~~~~~~~~~~~s~~~=~fromIntegral~\$~sum~ds
\end{tabbing}
\end{minipage}

For \text{\texfamily dirichlet\Sp 10} we see 2.7.
This does not appear too spectacular.
Greater numbers show:

\text{\texfamily dirichlet\Sp 100\Sp =\Sp 4.759}\\
\text{\texfamily dirichlet\Sp 250\Sp =\Sp 5.684}\\
\text{\texfamily dirichlet\Sp 500\Sp =\Sp 6.38}\\
\text{\texfamily dirichelt\Sp 1000\Sp =\Sp 7.069}

As we can see, the number is slowly increasing
resembling a log function or, more specifically,
the natural log. When we compare the natural log,
we indeed see that the results are close:

$\ln 100  = 4.605$\\
$\ln 250  = 5.521$\\
$\ln 500  = 6.214$\\
$\ln 1000  = 6.907$

For greater and greater numbers,
the difference of 
the \text{\texfamily dirichlet} function and 
the natural logarithm approaches

\begin{equation}
0.154435 \approx 2\gamma - 1.
\end{equation}

For the five examples above, the difference
is still significantly away from that number:

$\Delta 100 = 0.2148$\\
$\Delta 250 = 0.1625$\\
$\Delta 500 = 0.1635$\\
$\Delta 1000= 0.1612$,

but already $\Delta 2000 = 0.158$ comes close and
$\Delta 4000 = 0.1572$ 
approaches the value even further.

An important constant derived from $\gamma$ is
$e^{\gamma}$, which is a limit often seen in 
number theory. One instance is the lower bound
of the totient function. There is a clear upper bound,
namely $n-1$. Indeed, $\varphi(n)$ can never 
yield a value greater $n-1$ and this upper bound
is reached exclusively by prime numbers.
There is no such linear lower bound. 
That is, $\varphi(n)$ can assume values that are much smaller
than the value seen for $n-1$ or other numbers less than $n$.
But there is a lower bound that slowly grows with $n$.
This lower bound is often given as $\frac{n}{\ln\ln n}$.
This lower bound, however, is too big.
There are some values that are still below that border.
$\varphi(40)$, for instance, is 16.
$\frac{40}{\ln \ln 40}$, however, is around 30.
A better, even still not perfect approximation, is

\[
\frac{n}{e^{\gamma}\ln \ln n}.
\]

For $n=40$ again,
$\frac{40}{e^{\gamma}\ln \ln 40}$ is around 17 and, hence,
very close to the real value.

We see that $\gamma$ is really a quite mysterious number
that appears in different contexts, sometimes in quite
a subtle manner.
The greatest mystery, however, is that it is not so clear
that this number belongs here in the first place.
Indeed, it has not yet been shown that $\gamma$ is irrational.
In the approximations, we have studied in this section,
we actually have not seen 
the typical techniques to create irrational numbers 
like roots, continuous fractions and infinite series.
If $\gamma$ is indeed rational, then it must be the fraction
of two really large numbers. In 2003, it has been shown
that the denominator of such a fraction must be greater
than $10^{242080}$. 
A number big enough, for my taste, to speak of \speech{irrational}.
\section{Representation of Real Numbers}
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape Realrep}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~{\itshape Zahl}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}
\end{tabbing}
}

The set of real numbers $\mathbb{R}$ is
the union of the rational and the irrational numbers.
When we write real numbers on paper,
we use the decimal notation.
A number in decimal notation corresponds to 
an ordinary integer terminated by a dot
called the decimal point;
this integer corresponds to the part of the real number
greater 1 or 0 of course.
After the dot a stream of digits follows,
which is not necessarily a number in the common sense,
since it may start with zeros, \eg\ 0.0001.
In fact, one could say that the part after the dot
corresponds to a a reversed integer,
since the zero following this number
have no impact on the value of the whole expression,
\ie\ $0.10 = 0.1$.

Any rational number can be expressed in this system.
An integer corresponds just to the part before the dot:
$1.0 = 1$. A fraction like $\frac{1}{2}$ is written
as 0.5. We will later look at 
how this is computed concretely.
Rationals in decimal notation can be easily identified:
all numbers in decimal notation with a finite part
after the dot are rational: 
0.25 is $\frac{1}{4}$,
0.75 is $\frac{3}{4}$,
0.2  is $\frac{1}{5}$ and so on.

There are some rational numbers that are infinite.
For example, $\frac{1}{3}$ is $0.333333\dots$,
which we encode as $0.\overline{3}$.
Such periodic decimals are easy to convert
to fractions. We just have to multiply them
by a power of 10, such that there is a part
greater 0 before the decimal point and
that the first number
of the repeating period is aligned to it.
For $0.\overline{3}$, 
this is just $10\times 0.\overline{3} = 3.\overline{3}$.
For $0.1\overline{6}$,
it would be $10\times 0.1\overline{6} = 1.\overline{6}$.
For $0.\overline{09}$,
it would be $10^2\times 0.\overline{09} = 9.\overline{09}$.
We then subtract the original number from the result.
If the original number is $x$, we now have 
$10^nx - x = (10^n-1)x$.
For $x=0.\overline{3}$ this is $9x$;
for $x=0.1\overline{6}$ this, too, is $9x$ and
for $x=0.\overline{09}$ this is $99x$.
The results are 3, 1.5 and 9 respectively.
We now build a fraction of this result as numerator
and the factor (9 or 99) in the denominator.
Hence, $0.\overline{3} = \frac{3}{9} = \frac{1}{3}$,
$0.1\overline{6} = \frac{1.5}{9} = \frac{3}{18} = \frac{1}{6}$ and
$0.\overline{09} = \frac{9}{99} = \frac{1}{11}$.

A curiosity resulting from this calculations
is that $9\times 1/3 = 3$ and 
$9 \times 0.\overline{3} = 2.\overline{9}$
are actually the same! A correct implementation
must take this into account.
Try it with Haskell, you will see that
\text{\texfamily 9*0.3333333333333333} is indeed 3.
It will not work if you forget a three.
The precision of the \text{\texfamily {\itshape Double}} number type is 16
digits after the decimal point. With only 15 threes,
the result will be 2.9999999999999997.

Irrational numbers in the decimal notation
have infinite many digits after the decimal point.
With this said, it is obvious that we cannot
represent irrational numbers in this system.
We can of course represent any number by some
kind of formula like $\sqrt{5}$ and do some
math in this way such as $\frac{1+\sqrt{5}}{2}$,
\etc\ But often, when we are dealing with
applied mathematics, such formulas are not
very useful. We need an explicit number.
But, unfortunately or not, we have only
limited resources in paper, brainpower and
time. That is, at some point we have to 
abandon the calculations and work with what
can be achieved with the limited resources
we have at our disposal.

The point in time at which we take
the decision that we now have calculated
enough is the measure for the precision
of the real number type in question.
On paper, we would hence say that we
write only a limited number of digits
after the decimal point. In most day-to-day
situations where real numbers play a role,
like in dealing with money, cooking,
medication or travelling distances,
we calculate up to one or two decimal places.
Prices, for instances are often given 
as 4.99 or something, but hardly as 4.998.
Recipes would tell that we need 2.5 pounds
or whatever of something, using one decimal place.
One would say that it is about 1.5km 
to somewhere, but hardly that it is 1.499961km.
In other areas, especially in science 
much more precision is needed.
We therefore need a flexible datatype.

A nice and clean format to represent
real numbers uses two integers or,
as the following definition,
two natural numbers:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~{\bfseries data}~{\itshape RealN}~=~{\itshape R}~{\itshape Natural}~{\itshape Natural}
\end{tabbing}
\end{minipage}

The first number represents the integral part.
You will remember that a number is a list
of digits where every digit is multiplied
by a power of ten according to the place
of the digit. The first digit, counted from the right,
is multiplied by $10^0=1$. The second is 
multiplied by $10^1$, the third by $10^2$
and so on. 

The digit multiplied by $10^0$,
is the last digit before the decimal point.
If we wanted to push it to the right
of the decimal point, we would need
to reduce the exponent. So, we would multiply it
not by $10^0$, but by $10^{-1}$ to push it
to the first decimal place.
This is the function of the second number
in the datatype above.
It represents the value of the 
least significant bit in terms of
the exponent to which we have to raise 10 
to obtain the number represented by this datatype.
Since our datatype uses a natural number,
we have to negate it to find the exponent we need.

For instance, the number \text{\texfamily {\itshape R}\Sp 25\Sp 2}
corresponds to $25\times 10^{-2}$,
which we can reduce stepwise to
$2.5 \times 10^{-1}$ and $0.25 \times 10^0$.
A meaningful way to show this datatype would
therefore be:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~{\bfseries instance}~{\itshape Show}~{\itshape RealN}~{\bfseries where}\\
\texfamily ~~~~show~({\itshape R}~a~e)~=~show~a~++~\char34 *10\char94 (-\char34 ~++~show~e~++~\char34 )\char34 
\end{tabbing}
\end{minipage}

There are obviously many ways to represent the same
number with this number type. 
1, for instance, can be represented as

\text{\texfamily one\Sp =\Sp {\itshape R}\Sp 1\Sp \Sp \Sp \Sp 0}\\
\text{\texfamily one\Sp =\Sp {\itshape R}\Sp 10\Sp \Sp \Sp 1}\\
\text{\texfamily one\Sp =\Sp {\itshape R}\Sp 100\Sp \Sp 2}\\
\text{\texfamily one\Sp =\Sp {\itshape R}\Sp 1000\Sp 3}\\
$\dots$

To keep numbers as concise as possible, we define a function
to simplify numbers with redundant zeros:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~simplify~::~{\itshape RealN}~\char'31~{\itshape RealN}\\
\texfamily ~~simplify~({\itshape R}~0~\char95 )~=~{\itshape R}~0~0\\
\texfamily ~~simplify~({\itshape R}~a~e)~~|~~e~>~0~~\char'04\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~a~`rem`~10~\char'36~0~~=~~simplify~({\itshape R}~(a~`div`~10)~(e-1))\\
\texfamily ~~~~~~~~~~~~~~~~~~~~|~~otherwise~~~~~~~~=~~{\itshape R}~a~e
\end{tabbing}
\end{minipage}

As long as the exponent is greater 0 and the base $a$
is divisible by 10, we reduce the exponent by one
and divide $a$ by 10. In other words, we remove unnecessary zeros.
The following constructor uses \text{\texfamily simplify} to create
clean real numbers:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~real~::~{\itshape Natural}~\char'31~{\itshape Natural}~\char'31~{\itshape RealN}\\
\texfamily ~~real~i~e~=~simplify~({\itshape R}~i~e)
\end{tabbing}
\end{minipage}
\section{$\mathbb{R}$}
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape Real}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~{\itshape {\itshape Data}.Ratio}~((\%))\\
\texfamily ~~{\bfseries import}~qualified~{\itshape {\itshape Data}.Ratio}~as~{\itshape R}~(numerator,denominator)\\
\texfamily ~~{\bfseries import}~{\itshape Zahl}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}~hiding~(rdiv,~(\%))\\
\texfamily ~~{\bfseries import}~{\itshape Realrep}\\
\texfamily ~~{\bfseries import}~{\itshape {\itshape Debug}.Trace}~(trace)
\end{tabbing}
}

We now define how to check two real numbers
for equality:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~{\bfseries instance}~{\itshape Eq}~{\itshape RealN}~{\bfseries where}~\\
\texfamily ~~~~r1@({\itshape R}~a~e1)~\char'36~r2@({\itshape R}~b~e2)~~|~e1~\char'36~e2~~=~a~\char'36~b\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|~e1~>~~e2~~=~r1~\char'36~blowup~e1~r2\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|~e1~<~~e2~~=~blowup~e2~r1~\char'36~r2
\end{tabbing}
\end{minipage}

If the exponents are equal, then we 
trivially compare the coefficients.
Otherwise, we first expand the number
with the smaller exponent using \text{\texfamily blowup}:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~blowup~::~{\itshape Natural}~\char'31~{\itshape RealN}~\char'31~{\itshape RealN}\\
\texfamily ~~blowup~~i~({\itshape R}~r~e)~~|~i~\char'34~e~~~~~=~{\itshape R}~r~e\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~|~otherwise~~=~{\itshape R}~(r*10\char94 (i-e))~i~
\end{tabbing}
\end{minipage}

That is simple! If the target \text{\texfamily i} is greater
than the current exponent of the number,
we just multiply the coefficient by
10 raised to the difference of the target exponent
and the current exponent and make the target the new
exponent. Otherwise, nothing changes.

We continue with comparison,
which follows exactly the same logic:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~{\bfseries instance}~{\itshape Ord}~{\itshape RealN}~{\bfseries where}\\
\texfamily ~~~~compare~r1@({\itshape R}~a~e1)~r2@({\itshape R}~b~e2)~~|~e1~\char'36~e2~~=~compare~a~b\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|~e1~>~~e2~~=~compare~r1~(blowup~e1~r2)\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|~e1~<~~e2~~=~compare~(blowup~e2~r1)~r2
\end{tabbing}
\end{minipage}

Now we make \text{\texfamily {\itshape RealN}} instance of \text{\texfamily {\itshape Num}}:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~{\bfseries instance}~{\itshape Num}~{\itshape RealN}~{\bfseries where}\\
\texfamily ~~~~({\itshape R}~a~e1)~+~({\itshape R}~b~e2)~~|~~e1~\char'36~e2~~~=~simplify~\$~{\itshape R}~(a+b)~e1\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~|~~e1~>~~e2~~~=~simplify~\$~{\itshape R}~(a+b*10\char94 (e1-e2))~e1\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~|~~otherwise~~=~simplify~\$~{\itshape R}~(a*10\char94 (e2-e1)+b)~e2\\
\texfamily ~~~~({\itshape R}~a~e1)~-~({\itshape R}~b~e2)~~|~~e1~\char'36~e2~\char'04\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~a~~\char'35~b~~~~=~simplify~\$~{\itshape R}~(a-b)~e1\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~|~~e1~\char'36~e2~~~=~error~\char34 subtraction~beyond~zero!\char34 \\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~|~~e1~>~~e2~~~=~simplify~\$~({\itshape R}~a~e1)~-~({\itshape R}~(b*10\char94 (e1-e2))~e1)\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~|~~otherwise~~=~simplify~\$~({\itshape R}~(a*10\char94 (e2-e1))~e2)~-~({\itshape R}~b~e2)\\
\texfamily ~~~~({\itshape R}~a~e1)~*~({\itshape R}~b~e2)~=~real~(a*b)~(e1+e2)\\
\texfamily ~~~~negate~~r~~~~~~~=~r~{\rmfamily-{}-  we cannot negate natural numbers}\\
\texfamily ~~~~abs~~~~~r~~~~~~~=~r\\
\texfamily ~~~~signum~~r~~~~~~~=~r\\
\texfamily ~~~~fromInteger~i~~~=~{\itshape R}~(fromIntegral~i)~0
\end{tabbing}
\end{minipage}

Addition is again the same logic.
For two numbers with equal exponents,
we just add the coefficients.
If the exponents differ, 
we first convert the smaller number
to the greater exponent.

For subtraction, note that we define \text{\texfamily {\itshape RealN}}
like numbers before without negatives. To consider
signedness, we still have to use the datatype 
\text{\texfamily {\itshape Signed}\Sp {\itshape RealN}}.
Consequently, we have to rule out the case
where the first number is smaller than the second one.

Multiplication is interesting.
We multiply two real numbers
by multiplying the coefficients and
adding the exponents.
We have already seen this logic, when defining
the natural number type.
Some simple examples may convince you that this
is the right way to go.
$1 \times 0.1$, for instance, is 0.1.
In terms of our \text{\texfamily {\itshape RealN}} type, this corresponds to
\text{\texfamily ({\itshape R}\Sp 1\Sp 0)\Sp *\Sp ({\itshape R}\Sp 1\Sp 1)\Sp \char'36\Sp ({\itshape R}\Sp (1*1)\Sp (0+1)}.

The next task is to make \text{\texfamily {\itshape RealN}} instance of
\text{\texfamily {\itshape Fractional}}: 

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~{\bfseries instance}~{\itshape Fractional}~{\itshape RealN}~{\bfseries where}\\
\texfamily ~~~~(/)~=~rdiv~17~\\
\texfamily ~~~~fromRational~r~=~~({\itshape R}~(fromIntegral~\$~{\itshape R}.numerator~~~r)~0)~/~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~({\itshape R}~(fromIntegral~\$~{\itshape R}.denominator~r)~0)
\end{tabbing}
\end{minipage}

The method \text{\texfamily fromRational} is quite simple.
We just create two real numbers, 
the numerator of the original fraction and its denominator,
and the we divide them. What we need to do this,
of course, is division.
Division, as usual, is a bit more
complicated than the other arithmetic operations.
We define it as follows:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~rdiv~::~{\itshape Natural}~\char'31~{\itshape RealN}~\char'31~{\itshape RealN}~\char'31~{\itshape RealN}\\
\texfamily ~~rdiv~n~r1@({\itshape R}~a~e1)~r2@({\itshape R}~b~e2)~~|~~e1~<~e2~=~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~rdiv~n~(blowup~e2~r1)~r2\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|~~a~~<~b~\char'04~e1~\char'36~e2~=~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~rdiv~n~(blowup~(e2+1)~r1)~r2\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|~~otherwise~=~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~simplify~({\itshape R}~(go~n~a~b)~(e1~-~e2~+~n))\\
\texfamily ~~~~{\bfseries where}~~go~i~x~y~~|~~i~\char'34~0~=~0\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~|~~otherwise~=~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~{\bfseries case}~x~`quotRem`~y~{\bfseries of}\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~(q,0)~\char'31~10\char94 i~*~q\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~(q,r)~\char'31~{\bfseries let}~~(r',e)~~=~borrow~r~y\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~q'~~~~~~=~10\char94 i~*~q\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~{\bfseries in}~{\bfseries if}~e~>~i~~{\bfseries then}~q'~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~{\bfseries else}~q'~+~go~(i-e)~r'~y
\end{tabbing}
\end{minipage}

\text{\texfamily rdiv} has one more argument 
than the arithmetic operations seen before.
This additional argument, $n$, defines the
precision of the result.
This is necessary, because, as we will see,
the number of iterations
the function has to perform depends on the
precision the result is expected to have.

If the first number is smaller than the second,
either because its exponent or its
coefficient is smaller, we blow it up
so that it is at least the same size.
Then we calculate the new coefficient
by means of \text{\texfamily go} and the new exponent as
the difference of the first and the second exponent
plus the expected precision.
Note that division has the inverse effect on the size
of the exponents as multiplication.
When we look again at the example 1 and 0.1,
we have $1 / 0.1 = 10$, which translates to
\text{\texfamily ({\itshape R}\Sp 1\Sp 0)\Sp /\Sp ({\itshape R}\Sp 1\Sp 1)\Sp =\Sp {\itshape R}\Sp (1/1)\Sp (0-1)}, which
of course is the same as \text{\texfamily {\itshape R}\Sp 10\Sp 0}.

The inner function \text{\texfamily go} proceeds until \text{\texfamily i},
which initially is \text{\texfamily n}, becomes 0 or smaller.
In each step, we divide \text{\texfamily x}, initially the coefficient
of the first number, and \text{\texfamily y}, the coefficient of the
second number. If the result leaves no remainder,
we are done. We just raise \text{\texfamily q} to the power of 
the step in question. Otherwise, we continue
dividing the remainder \text{\texfamily r} by \text{\texfamily y}. But before
we continue, we borrow from \text{\texfamily y}, that is,
we increase \text{\texfamily r} until it is at least \text{\texfamily y}.
\text{\texfamily i} is then decremented by the number of zeros
we borrowed this way.
If we run out of \text{\texfamily i}, so to speak, that is
if $e > i$, then we terminate with \text{\texfamily q} raised
to the current step.

\text{\texfamily borrow} is just the same as \text{\texfamily blowup} applied
to two natural numbers:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~borrow~::~{\itshape Natural}~\char'31~{\itshape Natural}~\char'31~({\itshape Natural},{\itshape Natural})\\
\texfamily ~~borrow~a~b~~|~a~\char'35~b~~~~~=~~(a,0)\\
\texfamily ~~~~~~~~~~~~~~|~otherwise~~=~~{\bfseries let}~(x,e)~=~borrow~(10*a)~b~{\bfseries in}~(x,e+1)
\end{tabbing}
\end{minipage}

We now make \text{\texfamily {\itshape RealN}} instance of \text{\texfamily {\itshape Real}}.
We need to define just one method, namely
how to convert \text{\texfamily {\itshape RealN}} to \text{\texfamily {\itshape Rational}}, which
we do just by creating a fraction with 
the coefficient of the real number in the numerator
and 10 raised to the exponent in the denominator.
The rest is done by the \text{\texfamily {\itshape Rational}} number type:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~{\bfseries instance}~{\itshape Real}~{\itshape RealN}~{\bfseries where}\\
\texfamily ~~~~toRational~({\itshape R}~r~e)~=~i~\%~(10\char94 x)\\
\texfamily ~~~~~~{\bfseries where}~~i~~=~fromIntegral~r~::~{\itshape Integer}\\
\texfamily ~~~~~~~~~~~~~x~~=~fromIntegral~e~::~{\itshape Integer}
\end{tabbing}
\end{minipage}

We further add a function to convert
real numbers to our \text{\texfamily {\itshape Ratio}} type:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~r2R~::~{\itshape RealN}~\char'31~{\itshape Ratio}\\
\texfamily ~~r2R~({\itshape R}~a~e)~=~ratio~a~(10\char94 e)
\end{tabbing}
\end{minipage}

We also add a function to convert our real number type
to the standard \text{\texfamily {\itshape Double}} type:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~r2d~::~{\itshape RealN}~\char'31~{\itshape Double}\\
\texfamily ~~r2d~r@({\itshape R}~a~e)~~|~e~>~16~~~~~=~r2d~(roundr~16~r)\\
\texfamily ~~~~~~~~~~~~~~~~~|~otherwise~~=~(fromIntegral~a)~/~10\char94 e
\end{tabbing}
\end{minipage}

An inconvenience is that we have to round 
a number given in our number type so it fits
into a \text{\texfamily {\itshape Double}}.
For this, we assume that the \text{\texfamily {\itshape Double}} has a precision
of 16 decimal digits. This is not quite true.
The \text{\texfamily {\itshape Double}} type has room for 16 digits.
But if the first digits after the decimal point 
are zeros, the \text{\texfamily {\itshape Double}} type will present this
as a number raised to a negative exponent, just
as we do with our real type. In this case,
the \text{\texfamily {\itshape Double}} type may have a much higher precision
than 16. For our purpose, however, this is not too
relevant. 

So, here is how we round: 

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~roundr~::~{\itshape Natural}~\char'31~{\itshape RealN}~\char'31~{\itshape RealN}\\
\texfamily ~~roundr~n~({\itshape R}~a~e)~~|~n~\char'35~e~~~~~=~{\itshape R}~a~e\\
\texfamily ~~~~~~~~~~~~~~~~~~~~|~otherwise~~=~~{\bfseries let}~~b~~=~a~`div`~10\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~l~~=~a~-~10*b\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~d~~|~l~<~5~~~~~=~0\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|~otherwise~=~1\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~{\bfseries in}~roundr~n~({\itshape R}~(b+d)~(e-1))
\end{tabbing}
\end{minipage}

That is, we first get the least significant digit \text{\texfamily l} as
$l = a - 10 * (div~a~10)$, where, if \text{\texfamily div} is the Euclidian division,
the last digit of $a$ remains.
If the last digit is less than 5, we just drop it off.
Otherwise, we add 1 to the whole number.
If we now define

\text{\texfamily one\Sp =\Sp {\itshape R}\Sp 1\Sp 0}\\
\text{\texfamily three\Sp =\Sp {\itshape R}\Sp 3\Sp 0}\\
\text{\texfamily third\Sp =\Sp one\Sp /\Sp three},

then \text{\texfamily roundr\Sp 16\Sp (three\Sp *\Sp third)} yields 1, as desired.

Finally, we define

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~{\bfseries type}~{\itshape SReal}~=~{\itshape Signed}~{\itshape RealN}
\end{tabbing}
\end{minipage}

and have a fulfledged real number datatype.
\section{Real Factorials}
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape GFun}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}\\
\texfamily ~~{\bfseries import}~{\itshape Real}\\
\texfamily ~~{\bfseries import}~{\itshape Gamma}
\end{tabbing}
}

As we have already done in the domain of integers,
we will now try to generalise some of the combinatorial
sequences to the domain of real numbers.
We did this with integers
for the binomial coefficients.
Before we can introduce real binomials,
however, we need to look at factorials.
The factorial of $n$, $n!$, is the number of possible
permutations of a sequence of $n$ elements.
This is a very concrete and easy to grasp concept.
A function, however, that results in a 
fraction or even an irrational number
does not count anything similar to that.
It may measure a \emph{continuous} quantity 
(a weight or distance, for example), but certainly not
a \emph{discrete} value like a counting result.

This leads to a didactical dilemma 
that often arises in modern mathematics. 
Mathematics usually aims to generalise concepts
and often independent of concrete applications
of this generalised concept.
The applications often follow, sometimes years
or even centuries later.
We all know geometry in the two-dimensional plane.
Mathematicians have generalised the concepts of
two-dimensional geometry to $n$ dimensions.
From a na\"ive perspective looking 
only at immediate applicability,
there is not much sense
in such geometries beyond three or,
with Einstein in mind, four dimensions.
However, the areas of mathematics that study
\term{space} with more than four or even
infinitely many dimensions (such as linear algebra
and complex analysis), actually have many applications in
statistics, engineering, physics and other
rather practical domains.
Furthermore, applications is an important, but not
the only motivation for mathematical investigation.
Mathematics studies its fundamental concepts
(like numbers, sets or the space in which we
exercise geometry) to arrive at general theorems.
So, even when there is no immediate application yet,
for the sake of better understanding of the concepts involved,
mathematicians do not hesitate to ask questions
that appear to be absurd or meaningless to ``ordinary'' people
(whoever those are).

An obvious way to look at real factorials is to represent them
in the Cartesian plane, \ie\ in the coordinate system.
We can sketch the factorials of natural numbers as:

\begin{center}
\begin{tikzpicture}
   \draw [->] (0,0) -- (6,0);
   \draw [->] (0,0) -- (0,6.5);
   \node [teal,font=\small,anchor=north east] (fac) at (0,6.5) {$n!$};
   \node [teal,font=\small,anchor=north east] (fac) at (6,0) {$n$};
   \draw [red,fill=red] (0,0.05) circle (1pt);
   \draw [red,fill=red] (1,0.05) circle (1pt);
   \draw [red,fill=red] (2,0.1) circle (1pt);
   \draw [red,fill=red] (3,0.3) circle (1pt);
   \draw [red,fill=red] (4,1.2) circle (1pt);
   \draw [red,fill=red] (5,6) circle (1pt);
\end{tikzpicture}
\end{center}

where the factorials of $n$ are shown 
on the vertical axis (the $y$-axis)
with a scale of $1:10$ in relation to the values for $n$ 
on the horizontal axis (the $x$-axis).
The diagram shows the factorials 
of the numbers $n\in\lbrace 0, 1, 2, 3, 4, 5\rbrace$,
which are $1, 1, 2, 6, 24, 120$.
The factorials are drawn as dots with the coordinates
$(n,n!)$. The space between these dots is empty.
A continuous interpretation of the factorials would ask for the
values within this white space and aim to find a curve
that connects the discrete dots in the picture.

One obvious requirement for such a function $f$ is
that for any $n\in\mathbb{N}, f(n) = n!$.
A function that (almost) fulfils this requirement
is the \term{Gamma function}, $\Gamma$.
For any integer $n>1$, 
$\Gamma$ is

\begin{equation}
\Gamma(n) = (n-1)\Gamma(n-1)
\end{equation}

with $\Gamma(1)=1$.
We can model this in Haskell as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~gamman~::~{\itshape Natural}~\char'31~{\itshape Natural}\\
\texfamily ~~gamman~0~=~undefined\\
\texfamily ~~gamman~1~=~1\\
\texfamily ~~gamman~n~=~(n-1)*gamman~(n-1)
\end{tabbing}
\end{minipage}

When we apply this to the numbers $1\dots 10$,
\text{\texfamily map\Sp gamman\Sp [1..10]},
we see: 

\text{\texfamily [1,1,2,6,24,120,720,5040,40320,362880]}

There is a snag. Here are the factorials,
created with \text{\texfamily map\Sp fac\Sp [1..10]}:

\text{\texfamily [1,2,6,24,120,720,5040,40320,362880,3628800]}

The $\Gamma$ function, hence, creates the factorials,
but shifted down by one. Indeed, we have

\begin{equation}
\Gamma(n+1) = n!
\end{equation}

With \text{\texfamily [gamman\Sp (n+1)\Sp |\Sp n\Sp \char'06\Sp [1..10]]}, we finally see
the factorials in their correct places in the sequence:

\text{\texfamily [1,2,6,24,120,720,5040,40320,362880,3628800]}

That the $\Gamma$ function is defined like this,
is for historical reasons and does not need to bother
us here. We only have to keep in mind that, whenever
we want to make the connection from $\Gamma$ to factorial,
we need to increment $n$ by 1.

Well, the \text{\texfamily gamman} function above
shows us just another way to express
factorials for natural numbers. But we wanted to find
a function for real numbers.
There are indeed many ways to define the $\Gamma$ function
in that domain. The canonical way is 
the \term{Euler integral of the second kind},
but, since we have not yet introduced
integrals, we choose another way
that we already know, namely infinite products.

We first look at the following product, which
was found already by Euler:

\begin{equation}
\Gamma(x) = \frac{1}{x}\prod_{n=1}^{\infty}{
            \frac{(1+\frac{1}{n})^x}{1+\frac{x}{n}}}
\end{equation}

We can reformulate this equation in Haskell as:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~gammal~::~{\itshape Natural}~\char'31~{\itshape RealN}~\char'31~{\itshape RealN}\\
\texfamily ~~gammal~i~x~=~(1/x)*product~[(1+1/n)**x~/~(1+x/n)~|~n~\char'06~[1..m]]\\
\texfamily ~~~~{\bfseries where}~m~=~fromIntegral~i
\end{tabbing}
\end{minipage}

The function receives a \text{\texfamily {\itshape Natural}} and a \text{\texfamily {\itshape RealN}}.
The \text{\texfamily {\itshape Natural}}, $i$, is just the number of iterations
we want to perform, since we do not have the time
to go through all iterations of the infinite product.
The \text{\texfamily go} function implements the product itself.
Finally we multiply $\frac{1}{x}$ and we are done.

Let us look at how precise this function can mimic $n!$
for a given number of iterations. 
When we apply \text{\texfamily gammal} on $x=1$,
then we obviously get 1, since we compute

\[
\frac{1}{1}\prod_{n=1}^{\infty}{
\frac{(1+\frac{1}{n})^1}{1+\frac{1}{n}}} =
\prod_{n=1}^{\infty}{
\frac{1+\frac{1}{n}}{1+\frac{1}{n}}} =
1\times 1\times 1\times\dots = 1.
\]

Indeed, \text{\texfamily gammal\Sp 1\Sp 1} immediately yields 1.
Next, we try \text{\texfamily gammal\Sp 1\Sp 2} and get 
\[
0.\overline{6}
\]
That is far off the expected value 1.
We increase the number of iterations and try
\text{\texfamily gammal\Sp 10\Sp 2}:

\[
0.91666666\dots
\]

Already better, but still not 1.
We try \text{\texfamily gammal\Sp 100\Sp 2} and see:

\[
0.99019607\dots
\]

and \text{\texfamily gammal\Sp 1000\Sp 2}:

\[
0.99900199\dots
\]

We see, the function converges slowly.
When we try the factorials for $3\dots 6$ 
with \num{1000} iterations, we see:

\[
1.99401993\dots,5.96418512\dots,23.76178831\dots,118.21843985\dots
\]

The first two values are fairly close to the expected results.
$\Gamma(5)$ and $\Gamma(6)$, which should be
24 and 120, however, are clearly off.
We try \text{\texfamily gammal\Sp 10000\Sp 5} and see:

\[
23.97601798\dots
\]

Not good, but much better.
What about \text{\texfamily gammal\Sp 10000\Sp 6}?
Here it is:

\[
119.82018583\dots
\]

Still more than 0.1 off the expected result 120.
We try again with \num{100000} iterations:

\[
119.98200185\dots
\]

That was still not enough! Let us try with
one million iterations:

\[
119.99820001\dots
\]

We see that the infinite product slowly approaches
the expected results of the $\Gamma$ function, but
the stress here is on ``slowly''. Already for $x=6$,
we need a lot of iterations to achieve a deviation
of less than 0.01.

Let us look at another infinite product.
It is not faster than the one we looked at --
on the contrary, it is even slower --
but it is a nice formula:

\begin{equation}
\Gamma(x) = \frac{e^{-\gamma x}}{x}\prod_{n=1}^{\infty}{
\left(1+\frac{x}{n}\right)^{-1}e^{\frac{x}{n}}},
\end{equation}

where $\gamma$ is the Euler-Mascheroni constant
and $e$, the Euler-Napier constant.
This formula was found by German mathematician
Karl Weierstrass (1815 -- 1897) who was instrumental
in the foundations of modern analysis. 
In Haskell, his definition of the $\Gamma$ function 
may look like:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~gammae~::~{\itshape Natural}~\char'31~{\itshape RealN}~\char'31~{\itshape RealN}\\
\texfamily ~~gammae~i~x~=~f~*~product~[e**(x/n)~*~(1+(x/n))**(-1)~|~n~\char'06~[1..m]]\\
\texfamily ~~~~{\bfseries where}~~f~=~e**((-1)*\char'11*x)/x\\
\texfamily ~~~~~~~~~~~m~=~fromIntegral~(i-1)
\end{tabbing}
\end{minipage}

An important difference to the first formula is
that, from this one, it is not obvious that it
should result in 1 for $x=1$. Let us give it a try.
\text{\texfamily gammae\Sp 1\Sp 1}:

\[
0.56145836\dots
\]

That is an ugly result! Already for 1, it
diverges from the expected result by almost $\frac{1}{2}$!
Let us see how many iterations we need to approach 1:

\text{\texfamily gammae\Sp 10\Sp \Sp \Sp 1\Sp \Sp \Sp =\Sp 0.95043595...}\\
\text{\texfamily gammae\Sp 100\Sp \Sp 1\Sp \Sp \Sp =\Sp 0.99500219...}\\
\text{\texfamily gammae\Sp 1000\Sp 1\Sp \Sp \Sp =\Sp 0.99949804...}

and so on. What about 2?

\text{\texfamily gammae\Sp 1\Sp \Sp \Sp \Sp 2\Sp \Sp \Sp =\Sp 0.15761774...}\\
\text{\texfamily gammae\Sp 10\Sp \Sp \Sp 2\Sp \Sp \Sp =\Sp 0.82120772...}\\
\text{\texfamily gammae\Sp 100\Sp \Sp 2\Sp \Sp \Sp =\Sp 0.98022710...}\\
\text{\texfamily gammae\Sp 1000\Sp 2\Sp \Sp \Sp =\Sp 0.99799833...}

It definitely converges slower than Euler's formula.
For the remainder of this section, we will therefore stick
to Euler's solution.

Let us look at some other numbers,
not positive
integers, for instance:

\begin{minipage}{\textwidth}
\[
\Gamma(0) = \infty,
\]
\[
\Gamma(-1) = -\infty,
\]
\end{minipage}

So, $\Gamma(0)$ and $\Gamma(-1)$ yield $\pm\infty$.
What about $\frac{1}{2}$?
Using \text{\texfamily gammal}, we see the following results:

\begin{minipage}{\textwidth}
\text{\texfamily gammal\Sp \Sp \Sp \Sp 1\Sp 0.5\Sp =\Sp 1.8856...}\\
\text{\texfamily gammal\Sp \Sp \Sp 10\Sp 0.5\Sp =\Sp 1.7927...}\\
\text{\texfamily gammal\Sp \Sp 100\Sp 0.5\Sp =\Sp 1.7746...}\\
\text{\texfamily gammal\Sp 1000\Sp 0.5\Sp =\Sp 1.7726...}\\
\end{minipage}

It will finally approach: 

\[
\Gamma(0.5) = 1.77267520\dots
\]

Is it possible that $\Gamma(0.5)$ yields such a boring number?
Well, is it such boring? Look what happens (with one million iterations):

\text{\texfamily gammal\Sp 1000000\Sp 0.5\Sp *\Sp gammal\Sp 1000000\Sp 0.5\Sp =\Sp 3.14159...}

That is $\pi$! So $\Gamma(0.5) = \sqrt{\pi}$. Not bad!
The occurrence of both, $e$ and $\gamma$, in Weierstrass' formula
already looked somewhat suspicious. It was only a matter of time,
when we would meet $\pi$ in applying the function to some values.
In fact, there are many values for which $\Gamma$ produces
a product of $\sqrt{\pi}$ with some fraction. For instance:

\[
\Gamma\left(\frac{3}{2}\right) = \frac{1}{2}\sqrt{\pi},
\]
\[
\Gamma\left(\frac{5}{2}\right) = \frac{3}{4}\sqrt{\pi},
\]
\[
\Gamma\left(\frac{7}{2}\right) = \frac{15}{8}\sqrt{\pi},
\]
\[
\Gamma\left(\frac{9}{2}\right) = \frac{105}{16}\sqrt{\pi},
\]
\[
\dots
\]

These results suggest a pattern for odd numbers $n$.
Apparently, $\Gamma(\frac{n}{2})$ yields a product of the form
$\frac{k}{2^{(n-1)/2}}\sqrt{\pi}$,
where $k = (n-2)(k_{n-2})$.

Can we say more about the factor $k$?
For the odd numbers $1,3,\dots 11$, $k$ is
1, 3, 15, 105, 945, 10395.
These are the \term{double factorials}, $n!!$, 
for the odd numbers, \ie\
the products of all odd numbers $1,3,..,n$.
We, hence, have for odd numbers $n$:

\begin{equation}
\Gamma\left(\frac{n}{2}\right) = \frac{(n-2)!!}{2^{\frac{n-1}{2}}}\sqrt{\pi}
\end{equation}

which can be implemented in Haskell as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~gammaho~::~{\itshape Natural}~\char'31~{\itshape RealN}\\
\texfamily ~~gammaho~1~=~sqrt~\char'07\\
\texfamily ~~gammaho~n~~|~even~n~~~~~=~error~\char34 not~an~odd~number!\char34 \\
\texfamily ~~~~~~~~~~~~~|~otherwise~~=~rff~(n-2)~/~2**i~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~*~sqrt~\char'07\\
\texfamily ~~~~{\bfseries where}~~rff~~=~fromIntegral~\char'00~facfac\\
\texfamily ~~~~~~~~~~~i~~~~=~fromIntegral~((n-1)~`div`~2)
\end{tabbing}
\end{minipage}

The $\Gamma$ function shows many of such suprising properties.
It has been and is still being extensively studied 
and a lot of relations to other functions,
such as the Riemann zeta function, have been found.

But let us now go on to the definition of real binomial coefficients
using the $\Gamma$ function.
To this end, we define a new \text{\texfamily choose} function, namely:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~chooser~::~{\itshape Natural}~\char'31~{\itshape RealN}~\char'31~{\itshape RealN}~\char'31~{\itshape RealN}\\
\texfamily ~~chooser~i~n~k~=~~gammal~i~(n+1)~/~\\
\texfamily ~~~~~~~~~~~~~~~~~~~(gammal~i~(k+1)~*~gammal~i~(n-k+1))
\end{tabbing}
\end{minipage}

Again, we try this function on integers.
For instance:

\begin{minipage}{\textwidth}
\text{\texfamily choose\Sp 2\Sp 1\Sp =\Sp 2}\\
\text{\texfamily choose\Sp 3\Sp 1\Sp =\Sp 3}\\
\text{\texfamily choose\Sp 3\Sp 2\Sp =\Sp 3}\\
\text{\texfamily choose\Sp 5\Sp 2\Sp =\Sp 10}\\
\text{\texfamily choose\Sp 5\Sp 3\Sp =\Sp 10}\\
\text{\texfamily choose\Sp 7\Sp 2\Sp =\Sp 21}\\
\text{\texfamily choose\Sp 7\Sp 3\Sp =\Sp 35}
\end{minipage}

We start with $\binom{2}{1}=2$, using \text{\texfamily chooser}

\text{\texfamily chooser\Sp 1\Sp 2\Sp 1\Sp =\Sp 1.5}

Far off. So, again, we increase the number of iterations:

\begin{minipage}{\textwidth}
\text{\texfamily chooser\Sp \Sp \Sp \Sp \Sp 1\Sp 2\Sp 1\Sp =\Sp 1.5}\\
\text{\texfamily chooser\Sp \Sp \Sp \Sp 10\Sp 2\Sp 1\Sp =\Sp 1.8461...}\\
\text{\texfamily chooser\Sp \Sp \Sp 100\Sp 2\Sp 1\Sp =\Sp 1.9805...}\\
\text{\texfamily chooser\Sp \Sp 1000\Sp 2\Sp 1\Sp =\Sp 1.9980...}\\
\text{\texfamily chooser\Sp 10000\Sp 2\Sp 1\Sp =\Sp 1.9998...}
\end{minipage}

After \num{10000} iterations, we come pretty close.
Let us try the other examples with \num{10000} iterations:

\begin{minipage}{\textwidth}
\text{\texfamily chooser\Sp 10000\Sp 3\Sp 1\Sp =\Sp 2.9994...}\\
\text{\texfamily chooser\Sp 10000\Sp 3\Sp 2\Sp =\Sp 2.9994...}\\
\text{\texfamily chooser\Sp 10000\Sp 5\Sp 2\Sp =\Sp 9.9940...}\\
\text{\texfamily chooser\Sp 10000\Sp 5\Sp 3\Sp =\Sp 9.9940...}\\
\text{\texfamily chooser\Sp 10000\Sp 7\Sp 2\Sp =\Sp 10.9790...}\\
\text{\texfamily chooser\Sp 10000\Sp 7\Sp 3\Sp =\Sp 34.9580...}
\end{minipage}

which is fairly close for all these numbers.

The resulting function has been little studied.
It is known that many of the binomial identities
fail for real numbers. The behaviour for different
values of $n$ and $k$ not integers is very complex.
We will not go into details here. But we will certainly
come back to the $\Gamma$-function and its applications later on.


\ignore {
- History of the Gamma function
https://en.wikipedia.org/wiki/Binomial_coefficient#Two_real_or_complex_valued_arguments
Check numerical results against RealN!!!
}
\section{The Stern-Brocot Tree} 
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape SternBrocot}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape {\itshape Data}.List}~(sort,nub)\\
\texfamily ~~{\bfseries import}~{\itshape {\itshape Data}.Tree}\\
\texfamily ~~{\bfseries import}~{\itshape Cantor1}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~{\itshape Zahl}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}\\
\texfamily ~~{\bfseries import}~{\itshape Realrep}\\
\texfamily ~~{\bfseries import}~{\itshape Real}
\end{tabbing}
}

Achille Brocot (1817 -- 1878) was part of a clockmaker dynasty
in Paris started by his father and continuing after his death.
The Brocots had a strong emphasis on engineering.
Under the pressure of cheap low-quality imports
mainly from the USA, they
innovated clockmaking with the aim to reduce production cost
without equivalent degradation in quality.
The constant engineering work manifested in a considerable
number of patents hold by family members. The most productive,
in terms of engineering, however, was Achille who improved
many of his father's inventions and developed new ones.
He also introduced a novelty to mathematics, which, surprisingly,
has not only practical, but also theoretical value.

In clockmaking, as in machine construction in general,
determining the ratio of components to each other,
for instance, gear ratios, is a very frequent task.
As often in practice, those ratios are not nice and clean,
but very odd numbers with many decimal digits.
Brocot developed a way to easily approximate such numbers
with arbitrary precision and, in consequence, to approximate
any real number with arbitrary precision.
In the process, he developed yet another way 
to list all rational numbers.

Brocot's method can be described in terms 
of finite continued fractions. Recall that we can
use lists of the form

\[
[n;a,b,c,\dots]
\]

to encode continued fractions like

\[
n + \frac{1}{a+\frac{1}{b+\frac{1}{c+\dots}}}.
\]

In contrast to continued fractions we have seen so far,
we now look at finite continued fractions that actually
result in rational numbers. The process to compute
such a continued fraction can be captured in Haskell as:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~contfracr~::~[{\itshape Ratio}]~\char'31~{\itshape Ratio}\\
\texfamily ~~contfracr~~[]~~~~~~=~0\\
\texfamily ~~contfracr~~[i]~~~~~=~i~\\
\texfamily ~~contfracr~~(i:is)~~=~i~+~(invert~\$~contfracr~is)
\end{tabbing}
\end{minipage}

Here, \text{\texfamily invert} is a function to create the multiplicative
inverse of a fraction, \ie\ $invert(\frac{n}{d}) = \frac{d}{n}$
or in Haskell:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~invert~::~{\itshape Ratio}~\char'31~{\itshape Ratio}\\
\texfamily ~~invert~({\itshape Q}~n~d)~=~{\itshape Q}~d~n
\end{tabbing}
\end{minipage}

As you will see immediately, 
the expression \text{\texfamily (invert\Sp \$\Sp contfracr\Sp is)},
corresponds to 
\ignore{$}

\[
\frac{1}{\text{\textit{contfracr is}}}.
\]

The definition above, hence, creates a continued
fraction that terminates with the last
element in the list.

Now we introduce a simple rule to create
from any continued fraction given in list notation
two new continued fractions:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~brocotkids~::~[{\itshape Ratio}]~\char'31~([{\itshape Ratio}],[{\itshape Ratio}])\\
\texfamily ~~brocotkids~r~~=~~{\bfseries let}~~h~~~=~init~r\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~l~~~=~last~r\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~s~~~=~length~r\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~k1~~=~h++[l+1]\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~k2~~=~h++[l-1,2]\\
\texfamily ~~~~~~~~~~~~~~~~~~~{\bfseries in}~{\bfseries if}~even~s~{\bfseries then}~(k1,k2)~{\bfseries else}~(k2,k1)
\end{tabbing}
\end{minipage}

This function yields two lists, $k_1$ and $k_2$.
They are computed as 
the initial part of the input list,
to which, in the case of $k_1$, one number is appended,
namely the last element of the input list plus 1,
or, in the case of $k_2$, two numbers are appended, namely
the last element minus 1 and 2. 
For the input list \text{\texfamily [0,1]}, 
which is just 1,
for instance,
$k_1$ is \text{\texfamily [0,2]}, which is $\frac{1}{2}$, and
$k_2$ is \text{\texfamily [0,0,2]}, which is $\frac{1}{\frac{1}{2}} = 2$.

When we compare the paritiy of 
the length of the lists,
we see that $k_1$ has the same parity as the input list 
and $k_2$ has the opposite parity.
In particular, if the input list is even,
then $k_1$ is even and $k_2$ is odd; if it is odd,
then $k_1$ is odd and $k_2$ is even.

Now, we see for an even list like \text{\texfamily [a,b]} that there is an 
integer, $a$, to which the inverse of the second number,
$b$ is added. If $b$ grows, then the overall result shrinks.
The structure of an odd list is like \text{\texfamily [a,b,c]}.
Again, the integer $a$ is added to the inverse of
what follows in the list.
But this time, if $c$ grows, the inverse of $c$,
$\frac{1}{c}$, shrinks and, as such, the value of
$\frac{1}{b+1/c}$ grows.
Therefore, if the number of elements is even,
the value of $k_1$ is less than the value of the input list
and, if it is odd, then the value is greater.
You can easily convince yourself that for $k_2$
this is exactly the other way round.
In consequence, the numerical value of 
the left list returned by \text{\texfamily brocotkids}
is always smaller than that of the input list
and that of the right one is greater.

Using this function, we can now approximate any real number.
The idea is that, if the current continued fraction
results in a number greater than the number in question, we
continue with the left kid; if it is smaller,
we continue with the right kid. Here is an implementation:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~approx~::~{\itshape Natural}~\char'31~{\itshape RealN}~\char'31~[{\itshape Ratio}]\\
\texfamily ~~approx~i~d~=~go~i~[0,1]~\\
\texfamily ~~~~{\bfseries where}~~go~::~{\itshape Natural}~\char'31~[{\itshape Ratio}]~\char'31~[{\itshape Ratio}]\\
\texfamily ~~~~~~~~~~~go~0~\char95 ~~=~[]\\
\texfamily ~~~~~~~~~~~go~j~r~~=~~{\bfseries let}~~k@({\itshape Q}~a~b)~=~contfracr~r~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~d'~=~(fromIntegral~a)~/~(fromIntegral~b)\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~(k1,k2)~=~brocotkids~r\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~{\bfseries in}~{\bfseries if}~d'~\char'36~d~~{\bfseries then}~[{\itshape Q}~a~b]\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~{\bfseries else}~{\bfseries if}~d'~<~d~~{\bfseries then}~~k:go~(j-1)~k2\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~{\bfseries else}~~k:go~(j-1)~k1
\end{tabbing}
\end{minipage}
 
This function takes two arguments.
The first, a natural number, 
defines the number of iterations we want to do.
The second is the real number we want to approximate.
We start the internal \text{\texfamily go} with $i$ and the list \text{\texfamily [0,1]}.
In \text{\texfamily go}, as long as $j > 0$, 
we compute the rational number that corresponds to the input list;
then we compute the corresponding real number.
If the number we computed this way
equals the input (\ie\ the input is rational),
we are done. Otherwise, if it is less than the input, 
we continue with $k_2$;
if it is greater, we continue with $k_1$.

The function yields the whole trajectory whose
last number is the best approximation with $n$ iterations.
The result of \text{\texfamily approx\Sp 10\Sp \char'07}, for instance is:

\[
1,2,3,4,\frac{7}{2},
\frac{10}{3},
\frac{13}{4},
\frac{16}{5},
\frac{19}{6},
\frac{22}{7}.
\]

The last fraction $\frac{22}{7}$ is approximately
3.142857, which still is a bit away from 3.141592.
We reach 3.1415 with \text{\texfamily approx\Sp 25\Sp \char'07}, for which 
the last fraction is $\frac{333}{106} = 3.141509$. 
This way, we can come as close to $\pi$ as we wish.

Since, with the \text{\texfamily brocotkids} function, we always
create two follow-ups for the input list,
we can easily define a binary tree where, for each node,
$k_1$ is the left subtree and $k_2$ is the right subtree.
This tree, in fact, is well-known and is called 
\term{Stern-Brocot tree} in honour of Achille Brocot and
Moritz Stern, the German number theorist we already know
from the discussion of the Calkin-Wilf tree.

The Stern-Brocot tree can be defined as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~{\bfseries type}~{\itshape SterBroc}~=~{\itshape Tree}~[{\itshape Ratio}]\\
\texfamily \\
\texfamily ~~sterbroc~~::~{\itshape Zahl}~\char'31~[{\itshape Ratio}]~\char'31~{\itshape SterBroc}\\
\texfamily ~~sterbroc~~i~r~~|~i~\char'36~0~~~~~=~~{\itshape Node}~r~[]\\
\texfamily ~~~~~~~~~~~~~~~~~|~otherwise~~=~~{\bfseries let}~(k1,k2)~=~brocotkids~r\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~{\bfseries in}~{\itshape Node}~r~[~~sterbroc~(i-1)~k1,\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sterbroc~(i-1)~k2]
\end{tabbing}
\end{minipage}

The function \text{\texfamily sterbroc} takes an integer argument
to define the number of generations we want to create and
an initial list of \text{\texfamily {\itshape Ratio}}. If we have exhausted the number
of generations, we create the final \text{\texfamily {\itshape Node}} without kids.
Otherwise, we create the \text{\texfamily brocotkids} and continue with
\text{\texfamily sterbroc} on $k_1$ and $k_2$.
If we start with a negative number, we will generate 
infinitely many generations.

We can now convert the continued fractions in the nodes
to fractions by \text{\texfamily fmap}ing \text{\texfamily contfracr} on them. Here is a function
that creates the Stern-Brocot Tree from root node \text{\texfamily [0,1]}
labled with fractions:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~sterbrocTree~::~{\itshape Zahl}~\char'31~{\itshape Tree}~{\itshape Ratio}\\
\texfamily ~~sterbrocTree~i~=~fmap~contfracr~(sterbroc~i~[0,1])
\end{tabbing}
\end{minipage}

For the first five generations, this tree is

\begin{center}
\begin{tikzpicture}
% root
\node (A1) at ( 6,  0) {$\frac{1}{1}$};

% first level
\node (A2) at ( 3,-1 ) {$\frac{1}{2}$};
\node (A3) at ( 9,-1 ) {$\frac{2}{1}$};

% kids of A2
\node (A4) at (1.5,-2 ) {$\frac{1}{3}$};
\node (A5) at (4.5,-2 ) {$\frac{2}{3}$};

% kids of A3
\node (A6) at ( 7.5,-2 ) {$\frac{3}{2}$};
\node (A7) at (10.5,-2 ) {$\frac{3}{1}$};

% kids of A4
\node (A8) at (0.75,-3 ) {$\frac{1}{4}$};
\node (A9) at (2.25,-3 ) {$\frac{2}{5}$};

% kids of A5
\node (A10) at (3.75,-3 ) {$\frac{3}{5}$};
\node (A11) at (5.25,-3 ) {$\frac{3}{4}$};

% kids of A6
\node (A12) at (6.75,-3 ) {$\frac{4}{3}$};
\node (A13) at (8.25,-3 ) {$\frac{5}{3}$};

% kids of A7
\node (A14) at ( 9.75,-3 ) {$\frac{5}{2}$};
\node (A15) at (11.25,-3 ) {$\frac{4}{1}$};

% kids of A8
\node (A16) at (0.375,-4 ) {$\frac{1}{5}$};
\node (A17) at (1.125,-4 ) {$\frac{2}{7}$};

% kids of A9
\node (A18) at (1.875,-4 ) {$\frac{3}{8}$};
\node (A19) at (2.625,-4 ) {$\frac{3}{7}$};

% kids of A10
\node (A20) at (3.375,-4 ) {$\frac{4}{7}$};
\node (A21) at (4.125,-4 ) {$\frac{5}{8}$};

% kids of A11
\node (A22) at (4.875,-4 ) {$\frac{5}{7}$};
\node (A23) at (5.625,-4 ) {$\frac{4}{5}$};

% kids of A12
\node (A24) at (6.375,-4 ) {$\frac{5}{4}$};
\node (A25) at (7.125,-4 ) {$\frac{7}{5}$};

% kids of A13
\node (A26) at (7.875,-4 ) {$\frac{8}{5}$};
\node (A27) at (8.625,-4 ) {$\frac{7}{4}$};

% kids of A14
\node (A28) at ( 9.375,-4 ) {$\frac{7}{3}$};
\node (A29) at (10.125,-4 ) {$\frac{8}{3}$};

% kids of A15
\node (A30) at (10.875,-4 ) {$\frac{7}{2}$};
\node (A31) at (11.625,-4 ) {$\frac{5}{1}$};

% connect root
\connect {A1} {A2};
\connect {A1} {A3};

% connect A2
\connect {A2} {A4};
\connect {A2} {A5};

% connect A3
\connect {A3} {A6};
\connect {A3} {A7};

% connect A4
\connect {A4} {A8};
\connect {A4} {A9};

% connect A5
\connect {A5} {A10};
\connect {A5} {A11};

% connect A6
\connect {A6} {A12};
\connect {A6} {A13};

% connect A7
\connect {A7} {A14};
\connect {A7} {A15};

% connect A8
\connect {A8} {A16};
\connect {A8} {A17};

% connect A9
\connect {A9} {A18};
\connect {A9} {A19};

% connect A10
\connect {A10} {A20};
\connect {A10} {A21};

% connect A11
\connect {A11} {A22};
\connect {A11} {A23};

% connect A12
\connect {A12} {A24};
\connect {A12} {A25};

% connect A13
\connect {A13} {A26};
\connect {A13} {A27};

% connect A14
\connect {A14} {A28};
\connect {A14} {A29};

% connect A15
\connect {A15} {A30};
\connect {A15} {A31};

\end{tikzpicture}
\end{center}

As you can see at once, this tree has many properties
in common with the Calkin-Wilf tree.
First and trivially, the left kid of a node $k$ is less
than $k$ and the right kid of the same node is greater than $k$.
The left-most branch of the tree contains all fractions
with 1 in the numerator like
$\frac{1}{1},
 \frac{1}{2},
 \frac{1}{3},
 \frac{1}{4}$ and so on.
The right-most branch contains the integers 
$\frac{1}{1},
 \frac{2}{1},
 \frac{3}{1},
 \frac{4}{1}$ and so on.

Furthermore, the product of each generation is 1.
For instance,
$\frac{1}{1} = 1$,
$\frac{1}{2} \times \frac{2}{1} = 1$,
$\frac{1}{3} \times \frac{2}{3} \times
 \frac{3}{2} \times \frac{3}{1} = 1$ and so on.
In fact, we see in each generation the same fractions
we would also see in the Calkin-Wilf tree.
The order of the fraction, however, is different.
More precisely, the order of the inner fractions
differs, since, as we have seen, 
the left-most and right-most numbers are the same.

We could hence ask the obvious question:
how can we permute the generations of the Stern-Brocot tree
to obtain the generations of the Calkin-Wilf tree and vice versa?
Let us look at an example.
The $4^{th}$ generation of the Calkin-Wilf tree is\\
\text{\texfamily getKids\Sp 4\Sp (calWiTree\Sp 4\Sp ({\itshape Q}\Sp 1\Sp 1))}: 

\[
\frac{1}{4},
\frac{4}{3},
\frac{3}{5},
\frac{5}{2},
\frac{2}{5},
\frac{5}{3},
\frac{3}{4},
\frac{4}{1}.
\]

The $4^{th}$ generation of the Stern-Brocot tree is\\
\text{\texfamily getKids\Sp 4\Sp (sterbroctree\Sp 4)}: 

\[
\frac{1}{4},
\frac{2}{5},
\frac{3}{5},
\frac{3}{4},
\frac{4}{3},
\frac{5}{3},
\frac{5}{2},
\frac{4}{1}.
\]

We see that only some fractions changed their places
and the changes are all direct swaps, such that
the second position in the Calkin-Wilf tree changed with
the fifth position and
the fourth position changed with the seventh position.
The other positions, the first, third, sixth and eighth,
remain in their place. We could describe this in 
cyclic notation, using indexes from 0 -- 7 
for the eight positions:

\[
(1,4)(3,6).
\]

In other words,
we represent the generations as arrays with indexes 0 -- 7:

\begin{center}
\begingroup
\renewcommand{\arraystretch}{1.5}
\begin{tabular}{|c|c|c|c|c|c|c|c|c|}\hline
             & 0             & 1             & 2             & 3             & 4             & 5             & 6             & 7 \\\hline\hline
Calkin-Wilf  & $\frac{1}{4}$ & $\frac{4}{3}$ & $\frac{3}{5}$ & $\frac{5}{2}$ & $\frac{2}{5}$ & $\frac{5}{3}$ & $\frac{3}{4}$ & $\frac{4}{1}$\\\hline
Stern-Brocot & $\frac{1}{4}$ & $\frac{2}{5}$ & $\frac{3}{5}$ & $\frac{3}{4}$ & $\frac{4}{3}$ & $\frac{5}{3}$ & $\frac{5}{2}$ & $\frac{4}{1}$\\\hline
\end{tabular}
\endgroup
\end{center}

So, what is so special about the indexes 1, 3, 4 and 6
that distinguishes them from the indexes 0, 2, 5 and 7?
When we represent these numbers in binary format with
leading zeros, so that all binary numbers have the same length, we have

\begin{center}
\begin{tabular}{|c|c|c|c|c|c|c|c|}\hline
0    & 1   & 2    & 3   & 4   & 5   & 6   & 7 \\\hline\hline
000  & 001 & 010  & 011 & 100 & 101 & 110 & 111\\\hline
\end{tabular}
\end{center}

When we look at the indexes whose fractions do not change,
\ie\ 0, 2, 5 and 7,
we see one property that they all have in common:
they are all symmetric. That is, when we reverse the bit strings,
we still have the same number.
$0 = 000$ reversed is still $000 = 0$;
$2 = 010$ reversed is still $010 = 2$;
$5 = 101$ reversed is still $101 = 5$ and
$7 = 111$ reversed is still $111 = 7$.
$1 = 001$ reversed, however, is $100 = 4$ and vice versa and
$3 = 011$ reversed is $110 = 6$.
This corresponds exactly 
to the permutation $(1,4)(3,6)$
and is an instance of a bit-reversal permutation.

Let us try to implement the bit-reversal permutation.
First we implement the bit-reverse of the indexes.
To do so, we first need to convert the decimal index
into a binary number; then we add zeros in front of all
binary numbers that are shorter
than the greatest number; then we simply
reverse the lists of binary digits, remove the leading
zeros and convert back to decimal numbers.
This can be nicely expressed by the function

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~bitrev~::~{\itshape Int}~\char'31~{\itshape Int}~\char'31~{\itshape Int}\\
\texfamily ~~bitrev~x~=~~fromIntegral~\char'00~fromBinary~~~~~~~\char'00~\\
\texfamily ~~~~~~~~~~~~~~cleanz~\char'00~~reverse~\char'00~fillup~x~0~~\char'00~\\
\texfamily ~~~~~~~~~~~~~~toBinary~\char'00~fromIntegral
\end{tabbing}
\end{minipage}

where \text{\texfamily fillup} is defined as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~fillup~::~{\itshape Int}~\char'31~{\itshape Int}~\char'31~[{\itshape Int}]~\char'31~[{\itshape Int}]\\
\texfamily ~~fillup~i~z~is~~|~~length~is~\char'36~i~~=~is\\
\texfamily ~~~~~~~~~~~~~~~~~|~~otherwise~~~~~~~=~fillup~i~z~(z:is)
\end{tabbing}
\end{minipage}

and \text{\texfamily cleanz} as 

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~cleanz~::~[{\itshape Int}]~\char'31~[{\itshape Int}]\\
\texfamily ~~cleanz~[]~~~~~~=~[]\\
\texfamily ~~cleanz~[0]~~~~~=~[0]\\
\texfamily ~~cleanz~(0:is)~~=~cleanz~is\\
\texfamily ~~cleanz~is~~~~~~=~is
\end{tabbing}
\end{minipage}

To apply this, we first have to calculate
the size of the greatest number in our set
in binary format. If we assume that we have
a list of consecutive numbers from $0\dots n-1$,
then the size of the greatest number is just
$\log_2 n$, the binary logarithm of $n$.
For $n=8$, for instance, this is 3.
With this out of the way, we can define
a bit reversal of the indexes of any set \text{\texfamily [a]} as:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~idxbitrev~::~[a]~\char'31~[{\itshape Int}]\\
\texfamily ~~idxbitrev~xs~=~~{\bfseries let}~~l~~=~fromIntegral~\$~length~xs\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~x~~=~round~\$~logBase~2~(fromIntegral~l)\\
\texfamily ~~~~~~~~~~~~~~~~~~{\bfseries in}~~[bitrev~x~i~|~i~\char'06~[0..l-1]]
\end{tabbing}
\end{minipage}

and use this function to permute the original input list:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~bitreverse~::~[a]~\char'31~[a]\\
\texfamily ~~bitreverse~xs~=~go~xs~(idxbitrev~xs)\\
\texfamily ~~~~{\bfseries where}~~go~\char95 ~[]~~~~~~~=~[]\\
\texfamily ~~~~~~~~~~~go~zs~(p:ps)~~=~zs!!p~:~go~zs~ps
\end{tabbing}
\end{minipage}

Applied on the list \text{\texfamily [0,1,2,3,4,5,6,7]},
we see exactly the $(1,4)(3,6)$ permutation
we saw above, namely \text{\texfamily [0,4,2,6,1,5,3,7]}.
Applied on a generation from the Calkin-Wilf tree,
we see the corresponding generation from the 
Stern-Brocot tree.

Let \text{\texfamily t\Sp =\Sp calWiTree\Sp (-1)\Sp (1\%1)},
we see for 

\begin{center}
\begingroup
\renewcommand{\arraystretch}{1.5}
\begin{tabular}{|c|c|}\hline
\text{\texfamily getKids\Sp 3\Sp t} & 
$\frac{1}{3},
 \frac{3}{2},
 \frac{2}{3},
 \frac{3}{1}$ \\\hline
\text{\texfamily bitreverse\Sp (getKids\Sp 3\Sp t)} &
$\frac{1}{3},
 \frac{2}{3},
 \frac{3}{2},
 \frac{3}{1}$\\\hline
\text{\texfamily getKids\Sp 4\Sp t} & 
$\frac{1}{4},
 \frac{4}{3},
 \frac{3}{5},
 \frac{5}{2},
 \frac{2}{5},
 \frac{5}{3},
 \frac{3}{4}, 
 \frac{4}{1}$ \\\hline
\text{\texfamily bitreverse\Sp (getKids\Sp 4\Sp t)} &
$\frac{1}{4},
 \frac{2}{5},
 \frac{3}{5},
 \frac{3}{4},
 \frac{4}{3},
 \frac{5}{3},
 \frac{5}{2},
 \frac{4}{1}$\\\hline
\end{tabular}
\endgroup
\end{center}

Since the generations of the Stern-Brocot tree
are nothing but permutations of the Calkin-Wilf tree, we
can derive a sequence from the Stern-Brocot tree
that lists all rational numbers.
We create this sequence in exaclty the same way
we did for the CalkinWilf tree, namely

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~enumQsb~::~[{\itshape Ratio}]\\
\texfamily ~~enumQsb~=~go~1~\$~sterbrocTree~(-1)~\\
\texfamily ~~~~{\bfseries where}~go~i~t~=~getKids~i~t~++~go~(i+1)~t
\end{tabbing}
\end{minipage}\ignore{$}

The numerators of the sequence derived in this way
from the Calkin-Wilf tree equal the well-known Stern sequence.
Is there another well-known sequence that is equivalent
to the numerators of the Stern-Brocot tree sequence?
Let us ask the On-line Encyclopedia with the first segment
of that sequence generated by \text{\texfamily map\Sp numerator\Sp (take\Sp 20\Sp enumQsb)}:

\[
1,1,2,1,2,3,3,1,2,3,3,4,5,5,4,1,2,3,3,4,5,5,4,5,7.
\]

The Encyclopedia tells us that this is the numerators of
the \term{Farey sequence}.
This sequence, named for British geologist 
John Farey (1766 -- 1826), has a lot of remarkable properties.
The Farey sequence of $n$ lists all fractions 
in canoncial form between 0 and 1,
usually included, with a denominator less than or equal to $n$.
For instance, the Farey sequence of 1, designated $F_1$ just contains
$0,1$; $F_2$ contains $0,\frac{1}{2},1$;
$F_3$ contains $0,\frac{1}{3},\frac{2}{3},1$ and so on.

A direct way to implement this could be to combine all numbers
from $0\dots n$ in the numerator with all numbers $1\dots n$
in the denominator that are smaller than 1 and to sort and \text{\texfamily nub}
the resulting list, like this:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~farey2~::~{\itshape Natural}~\char'31~[{\itshape Ratio}]\\
\texfamily ~~farey2~n~=~sort~(nub~\$~~filter~(\char'34~1)~\$~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~concatMap~(\char'10x~\char'31~map~(x\%)~[1..n])~[0..n])
\end{tabbing}
\end{minipage}

With this approach, we create a lot of fractions
that we do not need and that we filter out again afterwards.
A more interesting approach, also in the light of the topic
of this section, is the following:

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~farey~::~{\itshape Natural}~\char'31~[{\itshape Ratio}]\\
\texfamily ~~farey~n~=~0~:~sort~(go~1~\$~sterbrocTree~(-1))\\
\texfamily ~~~~{\bfseries where}~~go~k~t~~=~~{\bfseries let}~~g~=~getKids~k~t\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~l~=~filter~fltr~g\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~{\bfseries in}~{\bfseries if}~null~l~{\bfseries then}~l~{\bfseries else}~l++go~(k+1)~t\\
\texfamily ~~~~~~~~~~~fltr~k~~=~~k~\char'34~1~\char'04~n~\char'35~denominator~k~
\end{tabbing}
\end{minipage}\ignore{$}

Here, we iterate over the generations of the Stern-Brocot tree
removing the fractions that are greater than 1 or have a denominator
greater n. When we do not get results anymore, \ie\ all denominators
are greater than $n$, we are done.

Let us try this algorithm on some numbers:

\begin{equation}
F_4 = \left\lbrace 0, 
\frac{1}{4}, 
\frac{1}{3}, 
\frac{1}{2}, 
\frac{2}{3}, 
\frac{3}{4}, 
1\right\rbrace
\end{equation}
\begin{equation}
F_5 = \left\lbrace 0, 
\frac{1}{5}, 
\frac{1}{4}, 
\frac{1}{3}, 
\frac{2}{5}, 
\frac{1}{2}, 
\frac{3}{5}, 
\frac{2}{3}, 
\frac{3}{4}, 
\frac{4}{5}, 
1\right\rbrace
\end{equation}
\begin{equation}
F_6 = \left\lbrace 0, 
\frac{1}{6}, 
\frac{1}{5}, 
\frac{1}{4}, 
\frac{1}{3}, 
\frac{2}{5}, 
\frac{1}{2}, 
\frac{3}{5}, 
\frac{2}{3}, 
\frac{3}{4}, 
\frac{4}{5}, 
\frac{5}{6}, 
1\right\rbrace
\end{equation}

We see some interesting properties.
First and this should be obvious,
we see $n$ as a denominator in sequence $F_n$ exaclty
$\varphi(n)$ times.
For $F_6$, for instance, we could create the fractions
$\frac{1}{6}$, 
$\frac{2}{6}$, 
$\frac{3}{6}$, 
$\frac{4}{6}$ and
$\frac{5}{6}$.
The fractions $\frac{2}{6}\dots\frac{4}{6}$, however,
are not in canonical form, since the numerators $2\dots 4$ 
all share divisors with 6. 
Since there are $\varphi(n)$ numerators
that do not share divisors with $n$,
there are only $\varphi(n)$ fractions less than 1
whith $n$ in the denominator. 

Another property is that, for two consecutive fractions
in the Farey sequence,
$\frac{a}{b}$ and $\frac{c}{d}$,
the cross products
$ad$ and $cb$ are consecutive integers.
In again $F_6$, 
for the fractions $\frac{1}{6}$ and $\frac{1}{5}$,
the cross products, trivially, are 5 and 6.
More interesting are 
the fractions $\frac{3}{5}$ and $\frac{2}{3}$ whose
cross products are $3\times 3 = 9$ and $5 \times 2 = 10$.

Even further, for any three consecutive fractions
in a Farey sequence, the middle one, called the mediant fraction,
can be calculated from the outer ones as
$\frac{a}{b}, \frac{a+c}{b+d}, \frac{c}{d}$.
For instance in $F_6$: 

\begin{equation}
 \frac{1+1}{6+4} = \frac{2}{10} = \frac{1}{5},
\end{equation}
\begin{equation}
 \frac{2+3}{5+5} = \frac{5}{10} = \frac{1}{2}
\end{equation}
and
\begin{equation}
 \frac{3+5}{4+6} = \frac{8}{10} = \frac{4}{5}.
\end{equation}

This property can be used to compute $F_{n+1}$ from $F_n$.
We just have to insert those mediant fractions 
of two consecutive fractions in $F_n$, for which
the denominator is $n+1$.
In $F_6$ we would insert

\[
\frac{0+1}{1+6},
\frac{1+1}{4+3},
\frac{2+1}{5+2},
\frac{1+3}{2+5},
\frac{2+3}{3+4},
\frac{5+1}{6+1}
\]

resulting in

\begin{equation}
F_7 = \left\lbrace 0, 
\frac{1}{7}, 
\frac{1}{6}, 
\frac{1}{5}, 
\frac{1}{4}, 
\frac{2}{7}, 
\frac{1}{3}, 
\frac{2}{5}, 
\frac{3}{7}, 
\frac{1}{2}, 
\frac{4}{7}, 
\frac{3}{5}, 
\frac{2}{3}, 
\frac{5}{7}, 
\frac{3}{4}, 
\frac{4}{5}, 
\frac{5}{6}, 
\frac{6}{7}, 
1\right\rbrace
\end{equation}

We can implement this as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~nxtFarey~::~{\itshape Natural}~\char'31~[{\itshape Ratio}]~\char'31~[{\itshape Ratio}]\\
\texfamily ~~nxtFarey~n~[]~~~=~[]\\
\texfamily ~~nxtFarey~n~[r]~~=~[r]\\
\texfamily ~~nxtFarey~n~(a:b:rs)~~|~~denominator~a~+~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~denominator~b~\char'36~n~~=~nxtFarey~n~(a:x:b:rs)\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~|~~otherwise~~~~~~~~~~~=~a:nxtFarey~n~(b:rs)\\
\texfamily ~~~~{\bfseries where}~x~=~~{\bfseries let}~~n1~=~numerator~a\\
\texfamily ~~~~~~~~~~~~~~~~~~~~n2~=~numerator~b\\
\texfamily ~~~~~~~~~~~~~~~~~~~~d1~=~denominator~a\\
\texfamily ~~~~~~~~~~~~~~~~~~~~d2~=~denominator~b\\
\texfamily ~~~~~~~~~~~~~~~{\bfseries in}~~(n1+n2)~\%~(d1+d2)
\end{tabbing}
\end{minipage}
 
In fact, we can construct the Stern-Brocot tree
by means of mediant fractions. The outer fractions,
in this algorithm are the predecessors of the current node,
namely the direct predecessor and either the predecessor
of the predecessor or the sibling of that node.
For instance, the second node in the third generation
is $\frac{2}{3}$. Its kids are 
$\frac{3}{5}$ and $\frac{3}{4}$.
$\frac{3}{5}$ is $\frac{2+1}{3+2}$ and, thus,
the sum of $\frac{2}{3}$ and its predecessor;
$\frac{4}{3}$, however, is $\frac{2+1}{3+1}$
and, hence, the sum of the $\frac{2}{3}$ 
and the predecessor of its predecessor.

The question now is how to bootstrap this algorithm,
since the root node does not have predecessors.
For this case, we imagine two predecessors, namely
the fractions $\frac{0}{1}$ and $\frac{1}{0}$,
the latter of which, of course, is not a proper fraction.
The assumption of such nodes, however, helps us derive
the outer branches, where, on the left side, the numerator
does not change, hence is constructed by addition with 0, and,
on the right side, the denominator does not change and is
likewise constructed by addition with 0.

We implement this as

\begin{minipage}{\textwidth}
\begin{tabbing}\texfamily
~~mSterbroctree~::~{\itshape Zahl}~\char'31~~{\itshape Natural}~\char'31~{\itshape Natural}~\char'31~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~{\itshape Natural}~\char'31~{\itshape Natural}~\char'31~{\itshape Ratio}~\char'31~{\itshape Tree}~{\itshape Ratio}\\
\texfamily ~~mSterbroctree~0~\char95 ~\char95 ~\char95 ~\char95 ~r~~=~~{\itshape Node}~r~[]\\
\texfamily ~~mSterbroctree~n~a~b~c~d~r~~=~~\\
\texfamily ~~~~{\bfseries let}~~rn~~=~numerator~r\\
\texfamily ~~~~~~~~~rd~~=~denominator~r\\
\texfamily ~~~~~~~~~k1~~=~(a+rn)~\%~(b+rd)\\
\texfamily ~~~~~~~~~k2~~=~(c+rn)~\%~(d+rd)\\
\texfamily ~~~~{\bfseries in}~~~{\bfseries if}~k1~<~k2\\
\texfamily ~~~~~~~~~{\bfseries then}~~{\itshape Node}~r~[~~mSterbroctree~(n-1)~a~b~rn~rd~k1,\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~mSterbroctree~(n-1)~c~d~rn~rd~k2]\\
\texfamily ~~~~~~~~~{\bfseries else}~~{\itshape Node}~r~[~~mSterbroctree~(n-1)~c~d~rn~rd~k2,\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~mSterbroctree~(n-1)~a~b~rn~rd~k1]
\end{tabbing}
\end{minipage}

Note that we have to use two pairs of natural numbers
instead of two fractions to encode the predecessors.
This is because we have to represent the imagined
predecessor $\frac{1}{0}$, which is not a proper fraction.
Finally, we check for the smaller of the resulting numbers
$k_1$ and $k_2$ to make sure that the smaller one 
always goes to the left and the greater to the right.
This implementation now gives exactly the same tree
as the implementation using continued fractions
introduced at the beginning of the section.

\section{Field Extension}
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape Extension}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~qualified~{\itshape {\itshape Data}.Ratio}~as~{\itshape R}~(numerator,denominator)\\
\texfamily ~~{\bfseries import}~{\itshape Zahl}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}~hiding~(rdiv)\\
\texfamily ~~{\bfseries import}~{\itshape Realrep}\\
\texfamily ~~{\bfseries import}~{\itshape {\itshape Debug}.Trace}~(trace)
\end{tabbing}
}

A very common activity of mathematicians is solving equations.
They usually solve equations with
coefficients of a certain type of numbers 
(like integers or rationals)
assuming that the solution
is of that same number type. 
A typical example is Diophantine equations,
named after the late-antique mathematician 
Diophantus of Alexandria who lived in the third century.
He studied equations and is the first mathematician
to be known to have introduced abstract symbols for numbers.
Diophantine equations operate over the integers.
The known values, \ie\ the coefficients, as well as the
unknown values, \ie\ the solutions, must be integers.
The most famous result from the study of Diophantine
equations is perhaps the proof of Fermat's Last Theorem,
which states that there are no solutions for $z>2$ in
equations of the form

\begin{equation} 
a^z + b^z = c^z
\end{equation} 

where $a$, $b$, $c$ and $z$ are all integers.
Fermat scribbled his conjecture
in the margin of his copy of Diophantus' ``Arithmetica''.
It turned
into his last \term{theorem} only when Andrew Wiles
proved it in the 90ies of the $20^{th}$ century
using concepts that went far beyond the knowledge
of Fermat and his contemporaries.

In modern times, equations are typically studied
in a \term{field} and you might remember that a field
is a structure defined over a set of numbers with
two operations. Both operations establish an 
\term{Abelian group}
with that set of numbers where one operation
(called \term{multiplication}) distributes over
the other (called \term{addition}).
More formally, a field is defined as a structure

\[
(S,+,\times),
\]

where $S$ is the set of numbers, ``$+$'' the addition
operation and ``$\times$'' multiplication.
For both operations, the following properties must hold: 

\begin{enumerate}
\item \textbf{Closure}: 
      for all $a,b \in S: a \circ b \in S$.
      
\item \textbf{Associativity}:
      $a \circ (b \circ c) = (a \circ b) \circ c = a \circ b \circ c$.

\item \textbf{Identity}:
      there is exactly one element $e \in S$, called the identity, such that
      for all $a \in S: a \circ e = e \circ a = a$.

\item \textbf{Invertibility}
      for each element $a \in S$, there is an element $a'$,
      such that $a \circ a' = e$.
      
\item \textbf{Commutativity}
      $a \circ b = b \circ a$.
\end{enumerate}

Properties 1 -- 4, as you will have realised, are just the group laws.
Property 5, commutativity, makes the group \term{Abelian}.

Furthermore, multiplication \textbf{distributes} over addition, i.e.

\[
a \times (b + c) = ab + ac.
\]

When all these properties hold, then we have a field.
We have already seen that $\mathbb{Q}$, the rational numbers,
is a field. Historically, this field was important for
the theory of solving equations. For the special case of
linear equations, that is equations without exponents,
rational coefficients lead to rational solutions. The reason is
that the operations we need to solve linear equations are
just the four arithmetic operations addition, subtraction,
multiplication and division. A simple equation of the form

\begin{equation}
ax + b = 0
\end{equation}

is solved by first subtracting $b$ from both sides of the equation
and then dividing both sides by $a$ leading to

\begin{equation}
x = -\frac{b}{a}.
\end{equation}

Note that the solutions are not necessarily integers,
like in Diophantine equations, since not every integer
has a multiplicative inverse. In other words, integers
do not constitute a group over multiplication and integers,
therefore, do not form a field.
In the field $\mathbb{Q}$ of rational numbers, however,
there is a solution (and exactly one solution) that lies
within that field.

But, of course, there are equations that cannot be solved
by applying the four fundamental arithmetic operations alone,
quadratic equations, for instance:

\begin{equation}
x^2 - 2 = 0.
\end{equation}

We proceed like for the linear equation: we subtract
$-2$ on both sides and then, instead of dividing by something,
we take the square root leading to

\begin{equation}
x = \sqrt{2}.
\end{equation}

Unfortunately, $\sqrt{2}$ is, as we already know,
not in the field $\mathbb{Q}$. It is irrational.
We can of course redefine the field 
in which we started to solve this equation in the first place
assuming $\mathbb{R}$ instead of $\mathbb{Q}$.
But that is a sloppy solution.
A typical question for a mathematician is:
what is the \emph{smallest} field comprising both,
the coefficients and the solutions of this kind of equations?
A possible answer is: the field $\mathbb{Q}$ with the solution
$\sqrt{2}$ added to it. 
That is, we \term{extend} the field $\mathbb{Q}$
by \term{adjoining} $\sqrt{2}$.
We should then get a new field, called $\mathbb{Q}(\sqrt{2})$,
of which the original field $\mathbb{Q}$ is a subfield,
\ie\

\[
\mathbb{Q} \subset \mathbb{Q}\left(\sqrt{2}\right).
\]

What does this new field look like?
Of course, we cannot just extend the underlying set, such like:

\[
S = \left\lbrace 0,1,\frac{1}{2},2,\frac{1}{3},3,
                 \dots,\infty,\sqrt{2}\right\rbrace.
\]

This, obviously, would not lead to a field, since
not for every $a\in S$ $a\sqrt{2} \in S$.
$2\times \sqrt{2}$, for instance, is not in the field;
$\frac{1}{2}\times \sqrt{2}$, too, is not in the field
and so on.
In fact, for almost no $a\in S$, closure is fulfilled.
It is fulfilled only for 0, the identity
and $\sqrt{2}$ itself, since $0\times\sqrt{2} = 0 \in S$,
$1\times \sqrt{2} = \sqrt{2} \in S$ and
$\sqrt{2} \times \sqrt{2} = 2 \in $S.

So, we need a better approach.
The following formalism defines the \term{smallest} field
that contains $\mathbb{Q}$ and the square root of any number
$r\in \mathbb{Q}$.
We first define a new number type consisting of a tuple $(a,b)$,
for $a,b \in \mathbb{Q}$. The natural interpretation of this tuple
is

\begin{equation}
(a,b) = a+b\sqrt{r}.
\end{equation}

The set underlying the field $\mathbb{Q}(\sqrt{r})$, thus,
consists of the numbers

\[
\left\lbrace a+b\sqrt{r} | a,b \in \mathbb{Q}\right\rbrace,
\]

with $r$ being a constant rational number, \ie\ $r\in\mathbb{Q}$. 
If you want to look at the concrete numbers,
you may reformulate this in terms of Haskell list comprehension:

\begin{tabbing}\texfamily
[~~(fromRational~a)~~+~\\
\texfamily ~~~(fromRational~b)~~*~(sqrt~r)~|~~a~~\char'06~enumQ,~\\
\texfamily ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~b~~\char'06~enumQ]
\end{tabbing}

Do not be confused by the fact
that, in Haskell, we have to convert $a$ and $b$ to real numbers.
Haskell has no built-in notion of field extension.
Numbers are either rational or real. Since \text{\texfamily sqrt\Sp r} is \text{\texfamily {\itshape RealN}},
we have to convert
everything to \text{\texfamily {\itshape RealN}}. The result, however, shows
what the numbers in the new field look like ``in reality'',
whatever that is supposed to mean.

Now we define the arithmetic operations in a way that fulfils 
the group properties. First, addition is

\begin{equation}\label{fieldExtAdd}
(a,b) + (c,d) = (a+c,b+d).
\end{equation}

That is easy and, in fact, follows from basic properties
of addition in the field $\mathbb{Q}$.
If we have something like $a+bx+c+dx$, we usually simplify to
$a+c+(b+d)x$. That is just the same as we did above.

Multiplication is a bit more complicated.
Let us first ask, how the product of two expressions
of the form $a+bx$ and $c+dx$ looks like:

\[
(a+bx)(c+dx)=ac+adx+bcx+bdx^2.
\]

Since, $x$ in our case is the square root of $r$, 
$x^2=\sqrt{r}\times\sqrt{r}=r$ 
and we, hence, get

\[
ac+rbd+(ad+bc)\sqrt{r}.
\]

From this we can derive the general rule

\begin{equation}\label{fieldExtMul}
(a,b)(c,d) = (ac+rbd,ad+bc),
\end{equation}

where $r$ is the number, whose square root is adjoint to our base field.
For $\mathbb{Q}(\sqrt{2})$, this is 

\begin{equation}
(a,b)(c,d) = (ac+2bd,ad+bc).
\end{equation}

This construction of the field extension guarantees
that for any addition and any multiplication 
of two elements in this new field, the result, again,
is an element of this field.
The rules also guarantee associativity,
as you may easily convince yourself.
But what about the identities of addition and multiplication?

In general, a rationl number $a$ is, in the new field,
represented as $(a,0)$.
This is easy to see, 
because $(a,0) = a+0\times\sqrt{r} = a$.
Since the additive identity is 0
in $\mathbb{Q}$, the identity should be $(0,0)$.
We just follow rule \ref{fieldExtAdd}
to prove that:

\begin{equation}
(a+b)+(0,0) = (a+0,b+0) = (a+b)\qed.
\end{equation}

What about the multiplicative identity?
We expect it to be the representation of 1 in the new field,
which is $(1,0)$, since $1+0\sqrt{r} = 1+0 = 1$.
Let us check:

\begin{equation}
(a+b)(1,0) = (1a+2b\times0,a\times 0+1b) = (a,b),
\end{equation}

which, indeed, fulfils the identity property.\qed

The next question is how the inverse will look like
in the new field.
For the additive inverse that is not difficult to answer.
Since, for any number $(a,b)$, the additive inverse $-(a,b)$
should fulfil the property $(a,b) + -(a,b) = (0,0)$,
the inverse must therefore be

\begin{equation}
-(a,b) = (-a,-b).
\end{equation}

We can check this quickly using again \ref{fieldExtAdd}:

\begin{equation}
(a,b) + (-a,-b)= (a-a,b-b)=(0,0).\qed
\end{equation}

Concerning multiplication, which, as usual, is a bit
more complicated than addition, the inverse is

\begin{equation}\label{fieldExtInvMul}
(a,b)^{-1} = \left(\frac{a}{a^2-rb^2},-\frac{b}{a^2-rb^2}\right).
\end{equation}

Here is the proof using \ref{fieldExtMul}:

\begin{equation}
\left(a,b\right)\left(\frac{a}{a^2-rb^2},-\frac{b}{a^2-rb^2}\right) = 
\left(\frac{a^2}{a^2-rb^2} - \frac{rb^2}{a^2-rb^2}, 
\frac{ab}{a^2-rb^2} - \frac{ab}{a^2-rb^2}\right). 
\end{equation}

The scary looking formula on the right-hand side of the equation
can be simplified. The first component is

\[
\frac{a^2}{a^2-rb^2} - \frac{rb^2}{a^2-rb^2},
\]

which can be reduced to one fraction,
since the denominators are equal:

\[
\frac{a^2-rb^2}{a^2-rb^2} = 1.
\]

We see a fraction with identical numerator and denominator.
The fraction, hence, can be further reduced to 1.

The second component is

\[
\frac{ab}{a^2-rb^2} - \frac{ab}{a^2-rb^2}=0.
\]

We finally get

\begin{equation}
\left(a,b\right)\left(\frac{a}{a^2-rb^2},-\frac{b}{a^2-rb^2}\right) = (1,0),
\end{equation}

which proves that the beast in \ref{fieldExtInvMul} fulfils
the invertibility property.\qed

The final piece in showing that $\mathbb{Q}(\sqrt{r})$ is indeed
a field considering the rules \ref{fieldExtAdd} and \ref{fieldExtMul}
is distributivity. Distributivity requires that

\begin{equation}
(a,b)((c,d) + (e,f)) = (a,b)(c,d) + (a,b)(e,f).
\end{equation}

Multiplying the left side out, we get

\[
(ac+rbd,ad+bc) + (ae+rbf,af+be),
\]

which, when added, is

\[
(ac+rbd+ae+rbf,ad+bc+af+be).
\]

We show that this is true by multiplying

\[
(a+b\sqrt{r})(c+d\sqrt{r} + e + f\sqrt{r}).
\]

We regroup the second part:

\[
c+e+d\sqrt{r}+f\sqrt{r}
\]

and distribute, first $a$:

\[
ac+ae+ad\sqrt{r}+af\sqrt{r}
\]

and then $b\sqrt{r}$:

\[
cb\sqrt{r}+eb\sqrt{r}+d\sqrt{r}b\sqrt{r}+f\sqrt{r}b\sqrt{r}.
\]

This second term simplifies to

\[
cb\sqrt{r}+eb\sqrt{r}+bdr+fbr.
\]

Now we bring the two terms together and get

\[
ac+ae+rbd+rbf+(ad+bc+af+be)\sqrt{r} = (ac+ae+rbd+rbf,ad+bc+af+be)
\]

as desired.\qed

We have defined the smallest field that extends $\mathbb{Q}$
by adjoining $\sqrt{r}$ for any rational number $r$.
This is nice, because it allows us to add the square roots
of any rational number using the same recipe.
We can even go further and extend the extended field by adjoining
the square roots of square roots on top of the extension already
containing the square roots, \ie:

\[
\mathbb{Q}(\sqrt{r},\sqrt[4]{r}).
\]

We can go still further and add the square roots 
of the square roots of the square roots:

\[
\mathbb{Q}(\sqrt{r},\sqrt[4]{r},\sqrt[8]{r})
\]

and then the square roots of the square roots of the square roots
of the square roots and so on \emph{ad infinitum}.
There are indeed classic problems, as we will see later, that can be solved
in exactly this field: $\mathbb{Q}$ extended by the $n^{th}$-roots,
where $n$ is any power of 2.

Extensions resulting from building extensions on top of extensions 
are sometimes called \term{towers of fields} where one field is
put on the top of another field yielding a batch of pancakes 
that slowly grows higher and higher.
This technique is often used in algebra, more specifically in 
\term{Galois Theory}, to study equations of higher degrees.
For instance, the equation

\begin{equation}
x^4 - 4x^3 - 4x^2 + 8x - 2 = 0
\end{equation}

has four solutions, namely

\begin{align*}
x_1 = 1 + \sqrt{2} + \sqrt{3 + \sqrt{2}}\\
x_2 = 1 + \sqrt{2} - \sqrt{3 + \sqrt{2}}\\
x_3 = 1 - \sqrt{2} + \sqrt{3 - \sqrt{2}}\\
x_4 = 1 - \sqrt{2} - \sqrt{3 - \sqrt{2}}
\end{align*}

We can build a tower of extensions of $\mathbb{Q}$ by
stepwise adjoining the irrational components of the solutions:

\begin{align*}
&\mathbb{Q}\\
&\mathbb{Q}\left(\sqrt{2}\right)\\
&\mathbb{Q}\left(\sqrt{2},\sqrt{3+\sqrt{2}}\right)\\
&\mathbb{Q}\left(\sqrt{2},\sqrt{3+\sqrt{2}},\sqrt{3-\sqrt{2}}\right)
\end{align*}

The interesting question presents itself whether it is possible
to build a tower from $\mathbb{Q}$ to $\mathbb{R}$.
It is indeed possible. But it is not trivial.
$\mathbb{R}$ is in fact much bigger than $\mathbb{Q}$.
How much bigger, we will soon see.

The difficulty arising in building that tower
is that we need different definitions for different
things we adjoin to $\mathbb{Q}$ and its extensions.
Until now, we have only looked at square roots.
But how to add $n$-roots where $n$ is not a power of two?
$\mathbb{Q}(\sqrt[3]{r})$, for instance, can not be represented
by the formulas above.
This is because $\sqrt[3]{r} \times \sqrt[3]{r}$
is not a rational number and is therefore not in the field.
The \term{degree} of this extension is not the same as that of
$\mathbb{Q}(\sqrt{r})$.
The degree of 
$\mathbb{Q}(\sqrt{r})$ is 2, since it can be represented by a pair of numbers
$(a,b)$.
$\mathbb{Q}(\sqrt[3]{r})$, however, cannot be represented by a pair;
a triple is needed, namely the triple

\[
(a,b,c) = a + b\sqrt[3]{r} + c\sqrt[3]{r^2}.
\]

The degree of $\mathbb{Q}(\sqrt[3]{r})$ is therefore 3.

What does the field $\mathbb{Q}(\sqrt[3]{r})$ look like?
For addition, it looks very similar to the field $\mathbb{Q}(\sqrt{r})$.
The addition rule is

\begin{equation}\label{fieldExtAdd3}
(a,b,c) + (d,e,f) = (a+d,b+e,c+f).
\end{equation}

The additive identity, trivially, is $(0,0,0)$.
The inverse $-(a,b,c)$ is $(-a,-b,-c)$.

Harder, however, is multiplication.
Let us investigate the multiplication rule.
We try to multiply two numbers in the new field

\[
(a,b,c)(d,e,f).
\]

This corresponds to the expression

\[
(a+b\sqrt[3]{r}+c\sqrt[3]{r^2})
(d+e\sqrt[3]{r}+f\sqrt[3]{r^2}).
\]

We distribute the first sum term by term
over the second sum.
Distributing $a$ gives

\[
ad+ae\sqrt[3]{r}+af\sqrt[3]{r^2};
\]

Distributing $b\sqrt[3]{r}$ gives

\[
bd\sqrt[3]{r}+be\sqrt[3]{r}\sqrt[3]{r}+bf\sqrt[3]{r}\sqrt[3]{r^2}
\]

and distributing $c\sqrt[3]{r^2}$ gives

\[
cd\sqrt[3]{r^2}+ce\sqrt[3]{r^2}\sqrt[3]{r}+cf\sqrt[3]{r^2}\sqrt[3]{r^2}.
\]

Now, we represent the roots as fractional exponents and get:

\[
ad+aer^{\frac{1}{3}}+afr^{\frac{2}{3}}
\]

for the first component,

\[
bdr^{\frac{1}{3}}+ber^{\frac{1}{3}}r^{\frac{1}{3}}+bfr^{\frac{1}{3}}r^{\frac{2}{3}}
\]

for the second and

\[
cdr^{\frac{2}{3}}+cer^{\frac{2}{3}}r^{\frac{1}{3}}+cfr^{\frac{2}{3}}r^{\frac{2}{3}}
\]

for the third.
We can simplify the second component to

\[
bdr^{\frac{1}{3}}+ber^{\frac{2}{3}}+bfr
\]

and the third to

\[
cdr^{\frac{2}{3}}+cer+cfr^{\frac{4}{3}}.
\]

The last term in this expression is not very nice.
It, apparently, introduces a new element that we do not yet know.
However, we can transform it:

\[
r^{\frac{4}{3}} = r^{\frac{3}{3} + \frac{1}{3}} = rr^{\frac{1}{3}}
\]

resulting in a product of two elements we do know already,
namely $r$, which is a rational number, and $r^{\frac{1}{3}}$,
which is just $\sqrt[3]{r}$.
The last component, hence, is

\[
cdr^{\frac{2}{3}}+cer+cfrr^{\frac{1}{3}}.
\]

We will now group the terms in the components according 
to their exponents. First the terms without exponent

\[
ad + bfr + cer,
\]

then those with exponent $\frac{1}{3}$:

\[
aer^{\frac{1}{3}} + bdr^{\frac{1}{3}} + cfrr^{\frac{1}{3}}
\]

and, finally, those with exponent $\frac{2}{3}$:

\[
afr^{\frac{2}{3}} + ber^{\frac{2}{3}} + cdr^{\frac{2}{3}}.
\]

When we convert the exponents back to roots, we see that
we have three groups:
one consisting of rational numbers only,
one consisting of rational numbers multiplied by $\sqrt[3]{r}$
and, finally, one consisting of rational numbers
multiplied by $\sqrt[3]{r^2}$.
We conclude that the multiplication formula in this field is

\begin{equation}\label{fieldExtMul3}
(a,b,c)(d,e,f) = (ad+bfr+cer,ae+bd+cfr,af+be+cd),
\end{equation}

where $r$ is the rational number, whose third root was
adjoint to $\mathbb{Q}$.

The multiplicative identity should be $(1,0,0)$ and, indeed,
$(a,b,c)(1,0,0)$ gives according to \ref{fieldExtMul3}:

\[
(a+0+0,0+b+0,0+0+c) = (a,b,c).\qed
\]

What, however, is the multiplicative inverse?
Well, answering this questions corresponds to solving
the equation

\begin{equation}
ad+bfr+cer + (ae+bd+cfr)\sqrt[3]{r} + (af+be+cd)\sqrt[3]{r^2} = 1.
\end{equation}

Solving such equations is a major topic of the next part.
With the techniques we have at our disposal now,
this is not easy. We will come back to that question later.
Anyway, what should be clear from the exercise is
that it is possible to extend the field $\mathbb{Q}$
step by step including always more irrational numbers
until we reach $\mathbb{R}$.
But this process is not trivial. It involves a lot of algebra.
It is a true Tower of Babel.
And, until here, we have only looked at irrational numbers
that are roots of rational numbers.
We have not yet discussed how to extend fields by 
\term{transcendental numbers}, \ie\ numbers that
are not roots of rational numbers and, even further,
do not appear as solutions of equations with
rational coefficients at all. 
Our friends $\pi$ and $e$ are
examples of such numbers. 

\ignore{
 http://math.stackexchange.com/questions/599930/extend-a-rational-number-field-mathbbq-by-using-a-transcendental-number
}
%\section{p-adic Numbers}
\section{The Continuum}
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape Cantor2}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape {\itshape Data}.List}~(nub,sort)\\
\texfamily ~~{\bfseries import}~{\itshape {\itshape Data}.Tree}\\
\texfamily ~~{\bfseries import}~{\itshape Fact}\\
\texfamily ~~{\bfseries import}~{\itshape Binom}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~{\itshape Zahl}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}
\end{tabbing}
}

So. How many real numbers are there?
As before, we will try to \term{count}
the real numbers by building a set of tuples
$(r,n)$ for all numbers $r\in \mathbb{R}$ and
$n\in\mathbb{N}$. In order to do this,
we need to first establish a sequence 
of real numbers. 
We start by investigating the real numbers
in the range $0\dots 1$.
We construct a sequence of 
real numbers in this interval.
We start by creating some sequence
like the following:

\begin{minipage}{\textwidth}
\[
0.10001\dots
\]
\[
0.01001\dots
\]
\[
0.00101\dots
\]
\[
0.00011\dots
\]
\[
0.00001\dots
\]
\[
\dots
\]
\end{minipage}

We now have an infinite sequence 
of infinite sequences of digits.
Can we enumerate this sequence and assign natural numbers 
to each single real number to count the whole sequence?
There is an issue. For any given sequence, we can easily
construct a new number, not yet in the sequence, but in
the same interval (the numbers $0\dots 1$).
The method is called 
Cantor's (second) \term{diagonal argument}.
It goes like this:
For each number in the sequence,
from the first number take the first digit,
from the second number take the second digit,
from the third number take the third digit
and so on.
Since the numbers in the sequence are distinct,
the new number, constructed in this way,
is different from all other numbers in the sequence.
For instance:

\begin{minipage}{\textwidth}
\[
0.\mathbf{1}0001\dots\\
\]
\[
0.0\mathbf{1}001\dots\\
\]
\[
0.00\mathbf{1}01\dots\\
\]
\[
0.000\mathbf{1}1\dots\\
\]
\[
0.0000\mathbf{1}\dots\\
\]
\[
\dots
\]
\[
0.\mathbf{11111}\dots\\
\]
\end{minipage}

Note that the sequence above was not particularly
designed to hold for this method. As long as the numbers are
irrational, \ie\ each of them consists of an infinite 
non-repeating sequence of digits, we will, 
following the method, always construct a number
that is not yet in the list.

The point is that we can do this with any sequence
of irrational numbers one may come up with.
In consequence, when we construct an enumeration 
of the real numbers, as we did for rational
numbers using the Calkin-Wilf or the Stern-Brocot tree,
there is always a number that we can introduce
between any two numbers in the sequence.
Any possible sequence of the real numbers, hence,
is necessarily incomplete.
We, therefore, arrive at the strange conclusion
that $|\mathbb{R}|\neq|\mathbb{N}|$ or,
in other words, $\mathbb{R}$ is not \term{countable}.

Cantor says that the sets are both infinite,
but they are infinite in different ways:
$\mathbb{N}$ is countably infinite, while
$\mathbb{R}$ is \term{uncountably} infinite.
There are thus different infinite cardinalities.
That of $\mathbb{N}$ is $\aleph_0$;
that of other sets may be $\aleph_1, \aleph_2, \aleph_3,\dots$
leading to a whole new universe of numbers
that express different ways of being infinite.

Cantor conjectured that the cardinality of $\mathbb{R}$
is the cardinality of the \term{powerset} of $\mathbb{N}$,
which is, as you may remember, $2^n$ for a set with $n$
elements. The cardinality of $\mathbb{R}$, would then be
$2^{\aleph_0}$.

This makes a lot of sense, 
when you consider the diagonal method above.
Indeed, when we created the powerset of a given set,
we used binary numbers to encode the presence or absence
of a given element in one of the sets in the powerset.
For the set $S=\lbrace a,b,c\rbrace$, the number $100_2$
would encode the set $\lbrace a\rbrace \in P(S)$.
Now, when you consider that $S$ is infinite,
you have an infinite sequence of such numbers and,
as we did above illustrating the diagonal argument,
we can introduce for any given such sequence
a new number, \ie\ a new element of $P(S)$.

Cantor further conjectured that
$\aleph_1 = 2^{\aleph_0}$.
That would mean that there is no infinite cardinality
``between'' that of $\mathbb{N}$ and that of $\mathbb{R}$.
Cantor's conjecture is very famous under the name
\term{Continuum Hypothesis} (\acronym{ch}).
In the early $20^{th}$ century it was important enough
for Hilbert to include it into his equally famous 23 problems
that he assumed to be the most important math problems
to be solved. It was, in fact, the first of these 23 problems.

The hypothesis as such is still unsolved today.
In 1940, however, Kurt Gödel showed
that \acronym{ch} cannot be disproven based on the standard
axiomatic system, the Zermelo-Fraenkel set theory (\acronym{zf}).
In 1963, again, Paul Cohen showed
that it cannot be proven in \acronym{zf} either.
Mathematicians today say that \acronym{ch} 
is \term{independent} from \acronym{zf}.
This may perhaps be translated into sloppy common speech as
\acronym{ch} is irrelevant, at least in the context
of the standard axiomatic system.

Without out too much phantasy, 
we can go beyond \acronym{ch} and suspect 
that there is a general rule that
for any $n \in \mathbb{N}: \aleph_n=2^{\aleph_{n-1}}$.
$\aleph_1=2^{\aleph_0}$ would then be no exception.
It would just be the way to count in infinity.
This hypothesis is called the
\term{Generalised Continuum Hypothesis} (\acronym{gch}).
The idea is extremely beautiful and, again,
it makes a lot of sense.
We cannot, of course, extend infinity
by just adding an element; that would still be infinity.
Between a set and its powerset, however, there is
a \emph{structural} difference that still holds,
as we have seen, with infinite sets.
There is no one-to-one mapping 
from the set to its powerset or, more formally worded,
``there is
no \term{surjection} from a set to its powerset''.
This is known as \term{Cantor's theorem} and
Cantor's diagonal argument demonstrates that 
the relation between the sets
$\mathbb{N}$ and $\mathbb{R}$
is an instance of this theorem.

The \acronym{gch}, just as the weaker \acronym{ch},
is also independent from \acronym{zf}.
There are, however, some stronger implications
when assuming the truth of \acronym{gch}, as shown, again,
by Kurt Gödel and by Polish mathematician
Wac\l{}aw Sierpiński (1882 -- 1969).
That, however, would lead us deeply 
into mathematical logic, which is not our topic here.
More interesting appears to be the question
what actually causes the difference between
the cardinalities of $\mathbb{N}$ and $\mathbb{R}$.

This question is discussed in Cantor's first article
on set theory, a tremendously important document
in the history of math.
In this short article -- it has less than five pages --
Cantor first proves that the set of real
\term{algebraic} numbers is countable and then
that the set of real numbers is not countable
providing this way a new proof for the existence
of the \term{transcendental} numbers
and demonstrating that it is the transcendental numbers
that make the set of real number uncountable.

To enumerate the algebraic numbers,
Cantor uses a sophisticated trick, that
involves mathematical machinery that is not yet
at our disposal. He uses \term{polynomials} --
those beasts will be a major topic of the next part --
that are \term{irreducible} over $\mathbb{Q}$.
He orders these polynomials and interprets
algebraic numbers as the \term{roots},
\ie\ the solutions, of the polynomials.
The first ten polynomials and their roots are:

\begin{center}
\begingroup
\renewcommand{\arraystretch}{1.5}
\begin{tabular}{|c|c|}
\hline
Polynomial & Root \\\hline\hline
$x$       & 0  \\\hline
$x+1$     & -1 \\\hline
$x-1$     & 1   \\\hline
$x+2$     & -2  \\\hline
$2x+1$    & $-\frac{1}{2}$ \\\hline
$2x-1$    & $\frac{1}{2}$  \\\hline
$x-2$     &  2             \\\hline
$x+3$     & -3             \\\hline
$x^2+x-1$ & $\frac{-1-\sqrt{5}}{2}$ \\\hline
$x^2-2$   & $-\sqrt{2}$ \\\hline
$\dots$   & $\dots$\\\hline
\end{tabular}
\endgroup
\end{center}

The column ``Root'' contains the components of the enumeration
of the algebraic numbers, which, hence, goes like

\[
0,-1,1,-2,-\frac{1}{2},\frac{1}{2},2,-3,\frac{-1-\sqrt{5}}{2},-\sqrt{2},\dots
\]

The enumeration technique is better than the one
he used to enumerate the rationals, since it contains
each algebraic number only once. Perhaps you remember
that, using Cantor's original technique 
for enumerating the rationals, we had to
filter out duplicates.

We see further that the sequence enumerates an extension
of $\mathbb{Q}$ containing roots of rational numbers and 
more complex formulas including such roots.
Since Cantor used the property of a real number
being algebraic, \ie\ appearing as a solution
of a polynomial with rational coefficients,
he guarantees that the resulting enumeration
contains exactly all algebraic numbers.
He, thus, proves that the cardinality of the set
of algebraic numbers equals $|\mathbb{N}| = \aleph_0$.
Since, as we have already seen,
the set of real numbers has not the cardinality $\aleph_0$,
this means that it is indeed the transcendental numbers
that make $\mathbb{R}$ uncountable.

\ignore{
first version:
- enumerating the algebraic numbers
https://en.wikipedia.org/wiki/Georg_Cantor%27s_first_set_theory_article
}
\section{Review of the Number Zoo}
\ignore{
\begin{tabbing}\texfamily
{\bfseries module}~{\itshape Zoo}\\
\texfamily {\bfseries where}\\
\texfamily ~~{\bfseries import}~{\itshape {\itshape Data}.List}~(nub,sort)\\
\texfamily ~~{\bfseries import}~{\itshape {\itshape Data}.Tree}\\
\texfamily ~~{\bfseries import}~{\itshape Fact}\\
\texfamily ~~{\bfseries import}~{\itshape Binom}\\
\texfamily ~~{\bfseries import}~{\itshape Natural}\\
\texfamily ~~{\bfseries import}~{\itshape Zahl}\\
\texfamily ~~{\bfseries import}~{\itshape Quoz}
\end{tabbing}
}

We have, in the previous chapters,
studied properties of numbers and
problems that are related to things
that are countable. On the way,
we repeatedly met concepts related
to sets with operations that show
certain properties, in particular
closure, associativity, identity and
invertibility. We found such structures
not only among numbers, but also 
in relation with other
objects like strings and permutations.

We called a structure of the form

\[
(S,\circ)
\]

consisting of a set $S$
and an operation $\circ$ a magma,
if the operation is closed over $S$,
\ie\

\[
a,b \in S \rightarrow a\circ b \in S.
\]

A magma is a universal structure found
in many contexts, not only numbers. But
we saw that the natural numbers, $\mathbb{N}$, 
form a magma together with both, addition
and multiplication. We can even go further
and predict that all number types that
we have constructed by extending the notion
of \term{natural number}, namely
$\mathbb{Z}$,
$\mathbb{Q}$ and
$\mathbb{R}$,
are magmas: they
are all closed under the operations $+$ and
$\times$. 

But there are other properties,
seen with $+$ and $\times$ together 
with any of our number types,
$\mathbb{N}$,
$\mathbb{Z}$,
$\mathbb{Q}$ or
$\mathbb{R}$.
First associativity:

\[
(a\circ b) \circ c = a\circ (b\circ c) = a \circ b \circ c.
\]

This property makes all our number types semigroups.
Furthermore, they all have an identity, $e$, together with
either of the operations, namely 0 for addition and 1
for multiplication, such that for any $a \in S$:

\[
a \circ e = e \circ a = a.
\]

This property makes all the number types together with
either of the operations monoids.

Now, we have seen that some of the number types and operations,
but not all of them,
have yet another property, namely invertibility, \ie\
the property that, for any $a \in S$, there is an element
$a' \in S$, such that

\[
a \circ a' = e.
\]

This property holds for 
$(\mathbb{Z},+)$, 
$(\mathbb{Q},+)$, $(\mathbb{Q},\times)$ and
$(\mathbb{R},+)$ as well as
$(\mathbb{R},\times)$.
Invertibility makes these structures groups.
The following sketch summarises this result:

\begin{center}
\begin{tikzpicture}
% root
\node (magma) at ( 6,  0) {Magma};

\node [red,font=\small] (assoc) at (8.5,-0.2) {+associativity};

% first level
\node (semigroup) at ( 9,-1 ) {Semigroup};

% kids of semigroup
\node[text width=2.5cm,font=\small] 
(semigroupg) at ( 7.5,-3 )
                         {$(\mathbb{N,+)}$,
                          $(\mathbb{N,\times)}$,
                          $(\mathbb{Z,+)}$,
                          $(\mathbb{Z,\times)}$,
                          $(\mathbb{Q,+)}$,
                          $(\mathbb{Q,\times)}$,
                          $(\mathbb{R,+)}$,
                          $(\mathbb{R,\times)}$
                           };
\ignore{$}

\node [red,font=\small] (identity) at (11.2,-1.3) {+identity};

\node (monoid) at (12,-2 ) {Monoid};

% kids of monoid
\node [red,font=\small] (inverse) at (14,-2.3) {+invertibility};

\node (group) at (14,-3 ) {Group};

% kids of group
\node (helper) at (14,-4) {};
\node[text width=3cm,font=\small] 
     (groupg) at (14.5,-4.5) 
                         {$(\mathbb{Z,+)}\hskip1.5cm$,
                          $(\mathbb{Q,+)}$,
                          $(\mathbb{Q,\times)}$,
                          $(\mathbb{R,+)}$,
                          $(\mathbb{R,\times)}$
                           };
\ignore{$}

% connect magma
\connect {magma} {semigroupg};
\connect {magma} {semigroup};

% connect semigroup
\connect {semigroup} {semigroupg};
\connect {semigroup} {monoid};

% connect monoid
\connect {monoid} {semigroupg};
\connect {monoid} {group};

% connect group
\connect {group} {helper};

\end{tikzpicture}
\end{center}

On top of these definitions,
a different kind of structures is defined,
that serves to distinguish different types
of numbers. These new structures consist of
a set and two operations, called 
addition and multiplication, respectively:

\[
(S,+,\times).
\]

If both operations form monoids over $S$,
then we call this structure a \textbf{semiring}.
An example of a semiring is $(\mathbb{N},+,\times)$,
since this structure consists of two monoids.
If addition forms a group over $S$ and 
multiplication forms a monoid, then we call
this structure a \textbf{ring}.
An example of a ring is $(\mathbb{Z},+,\times)$,
because addition in this structure is a group and
multiplication is a monoid.
If both, addition and multiplication, form
a group over $S$, we call the resulting strucure
a \textbf{field}. 
Examples for fields are $(\mathbb{Q},+,\times)$ and
$(\mathbb{R},+,\times)$, since these structures
have groups for both addition and multiplication.
Here is an overview over our number types:

\begin{center}
\begin{tikzpicture}
% root
\node (semiring)  at ( 6,  0) {Semiring};
\node (semiringg) at ( 5, -1) {$\mathbb{N}$};
\node (ring)      at ( 8, -1) {Ring};
\node (ringg)     at ( 7, -2) {$\mathbb{Z}$};
\node (field)     at ( 9, -2) {Field};
\node (fieldg)    at ( 9, -3) {$\mathbb{Q}$,
                                $\mathbb{R}$};

% connect 
\connect {semiring} {semiringg};
\connect {semiring} {ring};
\connect {ring} {ringg};
\connect {ring} {field};
\connect {field} {fieldg};

\end{tikzpicture}
\end{center}


\end{document}
